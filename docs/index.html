<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Johan Hidding" />
  <title>Zeeman’s catastrophe machine</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
  <!-- Load an icon library to show a hamburger menu (bars) on small screens -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <script>
  /* Toggle between showing and hiding the navigation menu links when the user clicks on the hamburger menu / bar icon */
  function toggleMenu() {
    var x = document.getElementById("myLinks");
    if (x.style.display === "block") {
      x.style.display = "none";
    } else {
      x.style.display = "block";
    }
  }
  
  </script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Zeeman’s catastrophe machine</h1>
<p class="author">Johan Hidding</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#literate-programming">Literate programming</a></li>
</ul></li>
<li><a href="#problem">Problem</a></li>
<li><a href="#catastrophe-analysis">Catastrophe analysis</a></li>
<li><a href="#numerical-methods">Numerical methods</a><ul>
<li><a href="#updating-the-state">Updating the state</a></li>
<li><a href="#bisection-method">Bisection method</a></li>
<li><a href="#newton-method">Newton method</a></li>
<li><a href="#looping">Looping</a></li>
<li><a href="#initialising-the-search">Initialising the search</a></li>
<li><a href="#updating-the-machine">Updating the machine</a></li>
</ul></li>
<li><a href="#appendix">Appendix</a><ul>
<li><a href="#plotting-the-machine-in-julia">Plotting the machine in Julia</a></li>
<li><a href="#rendering-svg">Rendering SVG</a></li>
<li><a href="#scaffold">Scaffold</a></li>
</ul></li>
<li><a href="#bibliography">References</a></li>
</ul>
</nav>
<div class="topnav">
<a href="#home" class="active">Logo</a>
<div id="myLinks">

</div>
<p><a href="javascript:void(0);" class="icon" onclick="toggleMenu()"> <i class="fa fa-bars"></i> </a></p>
</div>
<h2 id="introduction">Introduction</h2>
<p>This is a demo of Christopher Zeeman’s catastrophe machine. Zeeman was a British mathematician who is known for his work on singularity theory. He popularised a lot of the fundamental ideas put forward by René Thom on <em>catastrophe theory</em>.</p>
<p>Catastrophe theory describes how in dynamical systems, small changes in parameters can lead to large and sudden changes in the resulting behaviour. In particular, a system that is completely described by a smooth potential (continuous differentiable) can exert jumpy behaviour. This type of behaviour is found in many physical applications like the stability of ships, but also in optics.</p>
<p>The theory became quite popular in fields such as sociology and ecology. These areas of science are not normally associated with the mathematical rigour that we find in physics. It is mainly due to the complexity of the systems found in nature that these topics have defied exact mathematical descriptions, an idea that was also noted by Rene Thom in is foundational work “Structural Stability and Morphogenesis”.</p>
<p>Zeeman’s catastrophe machine illustrates catastrophic behaviour in a way that everyone should be able to understand. Here it is:</p>
<div id="machine">

</div>
<script src="zeeman.js"></script>
<script>
  Elm.Main.init({ node: document.getElementById("machine") });
</script>
<h3 id="literate-programming">Literate programming</h3>
<p>This demo is written in a style of <em>literate programming</em> <span class="citation" data-cites="Knuth1984">(Knuth 1984)</span>. The combined code-blocks in this demo compose the compilable source code. For didactic reasons we don’t always give the listing of an entire source file in one go. In stead, we use a system of references known as <em>noweb</em> <span class="citation" data-cites="Ramsey1994">(Ramsey 1994)</span>.</p>
<p>Inside source fragments you may encounter a line with <code>&lt;&lt;...&gt;&gt;</code> marks like in this C++ example,</p>
<p><em>«literate-example»=</em></p>
<div class="sourceCode" id="literate-example"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="literate-example-1"><a href="#literate-example-1"></a><span class="pp">#include </span><span class="im">&lt;cstdlib&gt;</span></span>
<span id="literate-example-2"><a href="#literate-example-2"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="literate-example-3"><a href="#literate-example-3"></a></span>
<span id="literate-example-4"><a href="#literate-example-4"></a>&lt;&lt;example-main-function&gt;&gt;</span></code></pre></div>
<p>which is then elsewhere specified. Order doesn’t matter,</p>
<p><em>«hello-world»=</em></p>
<div class="sourceCode" id="hello-world"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="hello-world-1"><a href="#hello-world-1"></a><span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Hello, World!&quot;</span> &lt;&lt; <span class="bu">std::</span>endl;</span></code></pre></div>
<p>So we can reference the <code>&lt;&lt;hello-world&gt;&gt;</code> code block later on.</p>
<p><em>«example-main-function»=</em></p>
<div class="sourceCode" id="example-main-function"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="example-main-function-1"><a href="#example-main-function-1"></a><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv) {</span>
<span id="example-main-function-2"><a href="#example-main-function-2"></a>  &lt;&lt;hello-world&gt;&gt;</span>
<span id="example-main-function-3"><a href="#example-main-function-3"></a>}</span></code></pre></div>
<p>A definition can be appended with more code as follows (in this case, order does matter!):</p>
<p><em>«hello-world»=+</em></p>
<div class="sourceCode" id="hello-world"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="hello-world-1"><a href="#hello-world-1"></a><span class="cf">return</span> EXIT_SUCCESS;</span></code></pre></div>
<p>These blocks of code can be <em>tangled</em> into source files.</p>
<h2 id="problem">Problem</h2>
<p>We have disk of radius <span class="math inline">\(R\)</span> at the origin, a pin on the edge of this disk at angle <span class="math inline">\(\theta\)</span>, an elastic <span class="math inline">\(a\)</span> from the pin to a fixed point on the <span class="math inline">\(x\)</span>-axis, and another elastic <span class="math inline">\(b\)</span> from the pin to a free moving pointer,</p>
<!-- see +@fig:system. -->
<figure>
<img src="system.svg" alt="" /><figcaption>Zeeman’s catastrophe machine</figcaption>
</figure>
<!-- {#fig:system} -->
<p>We define the machine model by the position of the pointer and the angle of the disc.</p>
<p><em>«machine-datatype»=</em></p>
<div class="sourceCode" id="machine-datatype"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="machine-datatype-1"><a href="#machine-datatype-1"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">Machine</span> <span class="op">=</span></span>
<span id="machine-datatype-2"><a href="#machine-datatype-2"></a>    { <span class="fu">f</span>     : <span class="dt">Position</span></span>
<span id="machine-datatype-3"><a href="#machine-datatype-3"></a>    <span class="op">,</span> <span class="fu">p</span>     : <span class="dt">Position</span></span>
<span id="machine-datatype-4"><a href="#machine-datatype-4"></a>    <span class="op">,</span> <span class="fu">theta</span> : <span class="dt">Float</span></span>
<span id="machine-datatype-5"><a href="#machine-datatype-5"></a>    }</span>
<span id="machine-datatype-6"><a href="#machine-datatype-6"></a></span>
<span id="machine-datatype-7"><a href="#machine-datatype-7"></a><span class="op">&lt;&lt;</span><span class="fu">potential</span><span class="op">&gt;&gt;</span></span>
<span id="machine-datatype-8"><a href="#machine-datatype-8"></a><span class="op">&lt;&lt;</span><span class="fu">elastic</span><span class="op">-</span><span class="fu">length</span><span class="op">&gt;&gt;</span></span>
<span id="machine-datatype-9"><a href="#machine-datatype-9"></a><span class="op">&lt;&lt;</span><span class="fu">derivatives</span><span class="op">&gt;&gt;</span></span></code></pre></div>
<p>At each time we need to minimize the potential given the pointer position, taking the current angle as the initial guess. To compute the potential, we model the elastics as linear springs, with a relaxed length of 1.</p>
<p>Let the pointer be at position <span class="math inline">\((x, y)\)</span> and the pinned end at position <span class="math inline">\((u, v)\)</span>, then the total potential energy is</p>
<p><span id="eq:potential-energy" class="eqnos"><span class="math display">\[V \sim \frac{1}{2} \left[ (l_a - 1)^2 + (l_b - 1)^2 \right],\]</span><span class="eqnos-number">(1)</span></span></p>
<p><em>«potential»=</em></p>
<div class="sourceCode" id="potential"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="potential-1"><a href="#potential-1"></a><span class="fu">potential</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="potential-2"><a href="#potential-2"></a><span class="fu">potential</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></span>
<span id="potential-3"><a href="#potential-3"></a>    <span class="kw">let</span> <span class="fu">l_a</span> <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">f</span> <span class="fu">theta</span></span>
<span id="potential-4"><a href="#potential-4"></a>        <span class="fu">l_b</span> <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span></span>
<span id="potential-5"><a href="#potential-5"></a>    <span class="kw">in</span> ((<span class="fu">l_a</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">l_b</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span></span></code></pre></div>
<p>where</p>
<p><span id="eq:length-a" class="eqnos"><span class="math display">\[l_{a}^2 = (\cos \theta - u)^2 + (\sin \theta - v)^2,\]</span><span class="eqnos-number">(2)</span></span> <span id="eq:length-b" class="eqnos"><span class="math display">\[l_{b}^2 = (\cos \theta - x)^2 + (\sin \theta - y)^2.\]</span><span class="eqnos-number">(3)</span></span></p>
<p><em>«elastic-length»=</em></p>
<div class="sourceCode" id="elastic-length"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="elastic-length-1"><a href="#elastic-length-1"></a><span class="fu">elasticLength</span> : <span class="dt">Position</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="elastic-length-2"><a href="#elastic-length-2"></a><span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span> <span class="op">=</span></span>
<span id="elastic-length-3"><a href="#elastic-length-3"></a>    <span class="fu">sqrt</span> <span class="op">&lt;|</span> (<span class="fu">cos</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">x</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span>)<span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<p>To compute the minimum it is convenient to have the derivative of the potential.</p>
<p><span id="eq:pd-la" class="eqnos"><span class="math display">\[\frac{\partial l_a}{\partial \theta} = \frac{u\sin\theta - v\cos\theta}{l_a},\]</span><span class="eqnos-number">(4)</span></span> <span id="eq:pd-pot" class="eqnos"><span class="math display">\[\frac{\partial V}{\partial l_a} \sim l_a - 1,\]</span><span class="eqnos-number">(5)</span></span></p>
<p>and similar for <span class="math inline">\(\partial V / \partial l_b\)</span>, which is then enough to construct a function computing <span class="math inline">\(\partial V / \partial \theta\)</span>.</p>
<p><em>«derivatives»=</em></p>
<div class="sourceCode" id="derivatives"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="derivatives-1"><a href="#derivatives-1"></a><span class="fu">dPotential</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="derivatives-2"><a href="#derivatives-2"></a><span class="fu">dPotential</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></span>
<span id="derivatives-3"><a href="#derivatives-3"></a>    <span class="kw">let</span> <span class="fu">l_a</span>  <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">f</span> <span class="fu">theta</span></span>
<span id="derivatives-4"><a href="#derivatives-4"></a>        <span class="fu">l_b</span>  <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span></span>
<span id="derivatives-5"><a href="#derivatives-5"></a>        <span class="fu">d_a</span> <span class="op">=</span> (<span class="fu">f</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">f</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_a</span></span>
<span id="derivatives-6"><a href="#derivatives-6"></a>        <span class="fu">d_b</span> <span class="op">=</span> (<span class="fu">p</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_b</span></span>
<span id="derivatives-7"><a href="#derivatives-7"></a>    <span class="kw">in</span> (<span class="fu">l_a</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">d_a</span> <span class="op">+</span> (<span class="fu">l_b</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">d_b</span></span></code></pre></div>
<p>Since we’ll use the Newton method to find the roots in the derivative, we’ll also need the second derivative. Noting that,</p>
<p><span id="eq:chainrule" class="eqnos"><span class="math display">\[\partial_{t}f = \partial_{a}f \partial_{t}a,\]</span><span class="eqnos-number">(6)</span></span> <span id="eq:double-chainrule" class="eqnos"><span class="math display">\[\partial_{tt}f = \partial_{aa}f(\partial_t a)^2 + \partial_a f \partial_{tt} a,\]</span><span class="eqnos-number">(7)</span></span> <span id="eq:pd2-la" class="eqnos"><span class="math display">\[\frac{\partial^2 l_a}{\partial \theta^2} = \frac{u\cos\theta + v\sin\theta - (\partial l_a / \partial \theta)^2}{l_a},\]</span><span class="eqnos-number">(8)</span></span></p>
<p>and</p>
<p><span id="eq:pd2-pot" class="eqnos"><span class="math display">\[\frac{\partial^2 V}{\partial l_a^2} = 1.\]</span><span class="eqnos-number">(9)</span></span></p>
<p><em>«derivatives»=+</em></p>
<div class="sourceCode" id="derivatives"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="derivatives-1"><a href="#derivatives-1"></a><span class="fu">d2Potential</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="derivatives-2"><a href="#derivatives-2"></a><span class="fu">d2Potential</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></span>
<span id="derivatives-3"><a href="#derivatives-3"></a>    <span class="kw">let</span> <span class="fu">l_a</span>   <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">f</span> <span class="fu">theta</span></span>
<span id="derivatives-4"><a href="#derivatives-4"></a>        <span class="fu">l_b</span>   <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span></span>
<span id="derivatives-5"><a href="#derivatives-5"></a>        <span class="fu">d_a</span>   <span class="op">=</span> (<span class="fu">f</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">f</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_a</span></span>
<span id="derivatives-6"><a href="#derivatives-6"></a>        <span class="fu">d_b</span>   <span class="op">=</span> (<span class="fu">p</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_b</span></span>
<span id="derivatives-7"><a href="#derivatives-7"></a>        <span class="fu">dd_a</span>  <span class="op">=</span> (<span class="fu">f</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">+</span> <span class="fu">f</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">d_a</span><span class="op">^</span><span class="dv">2</span>) <span class="op">/</span> <span class="fu">l_a</span></span>
<span id="derivatives-8"><a href="#derivatives-8"></a>        <span class="fu">dd_b</span>  <span class="op">=</span> (<span class="fu">p</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">+</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">d_b</span><span class="op">^</span><span class="dv">2</span>) <span class="op">/</span> <span class="fu">l_b</span></span>
<span id="derivatives-9"><a href="#derivatives-9"></a>    <span class="kw">in</span> <span class="fu">d_a</span><span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">l_a</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">dd_a</span> <span class="op">+</span> <span class="fu">d_b</span><span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">l_b</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">dd_b</span></span></code></pre></div>
<h2 id="catastrophe-analysis">Catastrophe analysis</h2>
<h2 id="numerical-methods">Numerical methods</h2>
<p>There are two methods that we will use to find the minimum of the potential: Newton and bisection. Newton’s method converges faster if we’re close to a minimum, but if the we’re far away, particularly somewhere where the slope of the potential is shallow, Newton behaves bad. This solution maintains an interval that straps the minimum inside. If the Newton method wants to exit this interval, we revert to bisection.</p>
<p>This method is similar to the Brent method which is a hybrid between bisection and secant method.</p>
<p>For visualisation purposes an <span class="math inline">\(\epsilon\)</span> of <span class="math inline">\(0.001\)</span> should suffice.</p>
<p><em>«brentish»=</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">epsilon</span> : <span class="dt">Float</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">epsilon</span> <span class="op">=</span> <span class="dv">0</span><span class="op">.</span><span class="dv">001</span></span></code></pre></div>
<p>We make sure that we always move down hill. This way we’ll never end up on a maximum. Now and then we have to check the sign of the first derivative to enforce this.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">signOf</span> : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">signOf</span> <span class="fu">x</span> <span class="op">=</span> <span class="cf">if</span> <span class="fu">x</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="cf">if</span> <span class="fu">x</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">then</span> <span class="op">-</span><span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span></span></code></pre></div>
<p>We keep a minimalisation state inside a record, to prevent overly long lists of function arguments. The two elements <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> always straddle the minimum, where <span class="math inline">\(b\)</span> is the last computed value.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="kw">type</span> <span class="dt">IterationMethod</span> <span class="op">=</span> <span class="dt">Guess</span> <span class="op">|</span> <span class="dt">Bisect</span> <span class="op">|</span> <span class="dt">Newton</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">Phase</span> <span class="op">=</span> { <span class="fu">x</span> : <span class="dt">Float</span><span class="op">,</span> <span class="fu">y</span> : <span class="dt">Float</span><span class="op">,</span> <span class="fu">dy</span> : <span class="dt">Float</span> }</span>
<span id="brentish-3"><a href="#brentish-3"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">MinState</span> <span class="op">=</span></span>
<span id="brentish-4"><a href="#brentish-4"></a>    { <span class="fu">f</span>    : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="brentish-5"><a href="#brentish-5"></a>    <span class="op">,</span> <span class="fu">df</span>   : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="brentish-6"><a href="#brentish-6"></a>    <span class="op">,</span> <span class="fu">a</span>    : <span class="dt">Phase</span></span>
<span id="brentish-7"><a href="#brentish-7"></a>    <span class="op">,</span> <span class="fu">b</span>    : <span class="dt">Phase</span></span>
<span id="brentish-8"><a href="#brentish-8"></a>    <span class="op">,</span> <span class="fu">last</span> : <span class="dt">IterationMethod</span> }</span></code></pre></div>
<p>The triple <span class="math inline">\(x\)</span>, <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(f&#39;(x)\)</span> are dubbed <em>phase</em>.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">phase</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Phase</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span> <span class="op">=</span> <span class="dt">Phase</span> <span class="fu">x</span> (<span class="fu">s</span><span class="op">.</span><span class="fu">f</span> <span class="fu">x</span>) (<span class="fu">s</span><span class="op">.</span><span class="fu">df</span> <span class="fu">x</span>)</span></code></pre></div>
<h3 id="updating-the-state">Updating the state</h3>
<p>The state is updated such that the points <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> always stradle the minimum and <span class="math inline">\(b\)</span> is the last computed point.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">intersect</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Phase</span> <span class="op">-&gt;</span> <span class="dt">MinState</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">intersect</span> <span class="fu">s</span> <span class="fu">p</span> <span class="op">=</span></span>
<span id="brentish-3"><a href="#brentish-3"></a>    <span class="cf">if</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">s</span><span class="op">.</span><span class="fu">a</span><span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">then</span></span>
<span id="brentish-4"><a href="#brentish-4"></a>        {<span class="fu">s</span> <span class="op">|</span> <span class="fu">b</span> <span class="op">=</span> <span class="fu">p</span> }</span>
<span id="brentish-5"><a href="#brentish-5"></a>    <span class="cf">else</span></span>
<span id="brentish-6"><a href="#brentish-6"></a>        {<span class="fu">s</span> <span class="op">|</span> <span class="fu">a</span> <span class="op">=</span> <span class="fu">s</span><span class="op">.</span><span class="fu">b</span><span class="op">,</span> <span class="fu">b</span> <span class="op">=</span> <span class="fu">p</span> }</span></code></pre></div>
<h3 id="bisection-method">Bisection method</h3>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">bisection</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">MinState</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">bisection</span> ({ <span class="fu">f</span><span class="op">,</span> <span class="fu">df</span><span class="op">,</span> <span class="fu">a</span><span class="op">,</span> <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="op">=</span></span>
<span id="brentish-3"><a href="#brentish-3"></a>    <span class="kw">let</span> <span class="fu">x</span> <span class="op">=</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span>) <span class="op">/</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span>)</span>
<span id="brentish-4"><a href="#brentish-4"></a>    <span class="kw">in</span> <span class="fu">intersect</span> { <span class="fu">s</span> <span class="op">|</span> <span class="fu">last</span> <span class="op">=</span> <span class="dt">Bisect</span> } <span class="op">&lt;|</span> <span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span></span></code></pre></div>
<h3 id="newton-method">Newton method</h3>
<p>The Newton method is accepted only if the result is inside the interval. Otherwise we revert to bisection. This implementation is different from ordinary root-finding Newton method, in that it only searches in a down-hill direction.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">inside</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Bool</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">inside</span> { <span class="fu">a</span><span class="op">,</span> <span class="fu">b</span> } <span class="fu">x</span> <span class="op">=</span></span>
<span id="brentish-3"><a href="#brentish-3"></a>    <span class="kw">let</span> <span class="fu">d</span> <span class="op">=</span> <span class="fu">abs</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span>)</span>
<span id="brentish-4"><a href="#brentish-4"></a>    <span class="kw">in</span> <span class="fu">abs</span> (<span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span>) <span class="op">&lt;</span> <span class="fu">d</span> <span class="op">&amp;&amp;</span> <span class="fu">abs</span> (<span class="fu">x</span> <span class="op">-</span> <span class="fu">b</span><span class="op">.</span><span class="fu">x</span>) <span class="op">&lt;</span> <span class="fu">d</span></span>
<span id="brentish-5"><a href="#brentish-5"></a></span>
<span id="brentish-6"><a href="#brentish-6"></a><span class="fu">newton</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">MinState</span></span>
<span id="brentish-7"><a href="#brentish-7"></a><span class="fu">newton</span> ({ <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="op">=</span></span>
<span id="brentish-8"><a href="#brentish-8"></a>    <span class="kw">let</span> <span class="fu">sign</span>       <span class="op">=</span> <span class="fu">signOf</span> <span class="fu">b</span><span class="op">.</span><span class="fu">y</span></span>
<span id="brentish-9"><a href="#brentish-9"></a>        <span class="fu">x</span>          <span class="op">=</span> <span class="fu">b</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">sign</span> <span class="op">*</span> <span class="fu">abs</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="fu">b</span><span class="op">.</span><span class="fu">dy</span>)</span>
<span id="brentish-10"><a href="#brentish-10"></a>    <span class="kw">in</span> <span class="cf">if</span> <span class="fu">inside</span> <span class="fu">s</span> <span class="fu">x</span> <span class="cf">then</span></span>
<span id="brentish-11"><a href="#brentish-11"></a>        <span class="fu">intersect</span> { <span class="fu">s</span> <span class="op">|</span> <span class="fu">last</span> <span class="op">=</span> <span class="dt">Newton</span> } <span class="op">&lt;|</span> <span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span></span>
<span id="brentish-12"><a href="#brentish-12"></a>    <span class="cf">else</span></span>
<span id="brentish-13"><a href="#brentish-13"></a>        <span class="fu">bisection</span> <span class="fu">s</span></span></code></pre></div>
<h3 id="looping">Looping</h3>
<p>The <code>findRoot</code> function is a generic function that keeps iterating on <code>newton</code> until a sattisfying result is found. This function is generic and should work for any input function.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">findRoot</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">findRoot</span> ({ <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="op">=</span></span>
<span id="brentish-3"><a href="#brentish-3"></a>    <span class="cf">if</span> <span class="fu">abs</span> <span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="fu">epsilon</span> <span class="cf">then</span></span>
<span id="brentish-4"><a href="#brentish-4"></a>        <span class="fu">b</span><span class="op">.</span><span class="fu">x</span></span>
<span id="brentish-5"><a href="#brentish-5"></a>    <span class="cf">else</span></span>
<span id="brentish-6"><a href="#brentish-6"></a>        <span class="fu">findRoot</span> (<span class="fu">newton</span> <span class="fu">s</span>)</span></code></pre></div>
<p>There is some more specialisation in how we initialise the search, finding an interval that should give us a good result.</p>
<h3 id="initialising-the-search">Initialising the search</h3>
<p>The first task is to find a pair of numbers <span class="math inline">\(x_a\)</span> and <span class="math inline">\(x_b\)</span> for which there is a root in <span class="math inline">\(f\)</span> for a value between <span class="math inline">\(x_a\)</span> and <span class="math inline">\(x_b\)</span>. Second criterium is that the derivatives of <span class="math inline">\(f\)</span> don’t change sign in the interval. If we’re close to an inflection point, which will happen a lot in this application, no such interval may exist. In that case we don’t change anything. Since we operate on a periodic space we’ll give a finite list of candidate intervals.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">bracket</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">List</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">MinState</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">bracket</span> ({ <span class="fu">f</span><span class="op">,</span> <span class="fu">df</span><span class="op">,</span> <span class="fu">a</span><span class="op">,</span> <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="fu">qs</span> <span class="op">=</span> <span class="cf">case</span> <span class="fu">qs</span> <span class="cf">of</span></span>
<span id="brentish-3"><a href="#brentish-3"></a>    []        <span class="op">-&gt;</span> <span class="dt">Nothing</span></span>
<span id="brentish-4"><a href="#brentish-4"></a>    (<span class="fu">x</span> <span class="op">::</span> <span class="fu">xs</span>) <span class="op">-&gt;</span> <span class="cf">if</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="fu">a</span><span class="op">.</span><span class="fu">dy</span> <span class="op">*</span> <span class="fu">b</span><span class="op">.</span><span class="fu">dy</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">then</span></span>
<span id="brentish-5"><a href="#brentish-5"></a>                    <span class="dt">Just</span> <span class="fu">s</span></span>
<span id="brentish-6"><a href="#brentish-6"></a>                 <span class="cf">else</span></span>
<span id="brentish-7"><a href="#brentish-7"></a>                    <span class="fu">bracket</span> { <span class="fu">s</span> <span class="op">|</span> <span class="fu">a</span> <span class="op">=</span> <span class="fu">b</span><span class="op">,</span> <span class="fu">b</span> <span class="op">=</span> <span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span> } <span class="fu">xs</span></span></code></pre></div>
<p>We feed the <code>bracket</code> function a list of angles.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">allAngles</span> : <span class="dt">List</span> <span class="dt">Float</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">allAngles</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">i</span> <span class="op">-&gt;</span> (<span class="fu">toFloat</span> <span class="fu">i</span>) <span class="op">*</span> <span class="dv">2</span><span class="op">.</span><span class="dv">0</span> <span class="op">*</span> <span class="fu">pi</span> <span class="op">/</span> <span class="dv">100</span>) (<span class="dt">List</span><span class="op">.</span><span class="fu">range</span> <span class="dv">0</span> <span class="dv">100</span>)</span></code></pre></div>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">initMin</span> : (<span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span>) <span class="op">-&gt;</span> (<span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span>) <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">MinState</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">initMin</span> <span class="fu">f</span> <span class="fu">df</span> <span class="fu">x</span> <span class="op">=</span></span>
<span id="brentish-3"><a href="#brentish-3"></a>    <span class="kw">let</span> <span class="fu">a</span> <span class="op">=</span> <span class="dt">Phase</span> <span class="fu">x</span> (<span class="fu">f</span> <span class="fu">x</span>) (<span class="fu">df</span> <span class="fu">x</span>)</span>
<span id="brentish-4"><a href="#brentish-4"></a>        <span class="fu">s</span> <span class="op">=</span> <span class="dt">MinState</span> <span class="fu">f</span> <span class="fu">df</span> <span class="fu">a</span> <span class="fu">a</span> <span class="dt">Guess</span></span>
<span id="brentish-5"><a href="#brentish-5"></a>        <span class="fu">sign</span> <span class="op">=</span> <span class="fu">signOf</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span></span>
<span id="brentish-6"><a href="#brentish-6"></a>    <span class="kw">in</span> <span class="fu">bracket</span> <span class="fu">s</span> <span class="op">&lt;|</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">theta</span> <span class="op">-&gt;</span> <span class="fu">x</span> <span class="op">-</span> <span class="fu">sign</span> <span class="op">*</span> <span class="fu">theta</span>) <span class="fu">allAngles</span></span></code></pre></div>
<h3 id="updating-the-machine">Updating the machine</h3>
<p>In updating the machine state, the last step is to retrieve a value between <span class="math inline">\(0\)</span> and <span class="math inline">\(2\pi\)</span>. This step is not essential, but it keeps me sane.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="brentish-1"><a href="#brentish-1"></a><span class="fu">modulo</span> : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></span>
<span id="brentish-2"><a href="#brentish-2"></a><span class="fu">modulo</span> <span class="fu">x</span> <span class="fu">m</span> <span class="op">=</span> <span class="fu">x</span> <span class="op">-</span> (<span class="fu">toFloat</span> <span class="op">&lt;|</span> <span class="fu">floor</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">/</span> <span class="fu">m</span>) <span class="op">*</span> <span class="fu">m</span></span>
<span id="brentish-3"><a href="#brentish-3"></a></span>
<span id="brentish-4"><a href="#brentish-4"></a><span class="fu">minimizeMachine</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Machine</span></span>
<span id="brentish-5"><a href="#brentish-5"></a><span class="fu">minimizeMachine</span> <span class="fu">m</span> <span class="op">=</span></span>
<span id="brentish-6"><a href="#brentish-6"></a>    <span class="kw">let</span> <span class="fu">f</span>  <span class="op">=</span> \ <span class="fu">theta</span> <span class="op">-&gt;</span> <span class="fu">dPotential</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">theta</span> }</span>
<span id="brentish-7"><a href="#brentish-7"></a>        <span class="fu">df</span> <span class="op">=</span> \ <span class="fu">theta</span> <span class="op">-&gt;</span> <span class="fu">d2Potential</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">theta</span> }</span>
<span id="brentish-8"><a href="#brentish-8"></a>        <span class="fu">ms</span>  <span class="op">=</span> <span class="fu">initMin</span> <span class="fu">f</span> <span class="fu">df</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span></span>
<span id="brentish-9"><a href="#brentish-9"></a>    <span class="kw">in</span> <span class="cf">case</span> <span class="fu">ms</span> <span class="cf">of</span></span>
<span id="brentish-10"><a href="#brentish-10"></a>        <span class="dt">Just</span> <span class="fu">s</span>  <span class="op">-&gt;</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">modulo</span> (<span class="fu">findRoot</span> <span class="fu">s</span>) (<span class="dv">2</span> <span class="op">*</span> <span class="fu">pi</span>) }</span>
<span id="brentish-11"><a href="#brentish-11"></a>        <span class="dt">Nothing</span> <span class="op">-&gt;</span> <span class="fu">m</span></span></code></pre></div>
<h2 id="appendix">Appendix</h2>
<h3 id="plotting-the-machine-in-julia">Plotting the machine in Julia</h3>
<p><em>«plot-system»=</em></p>
<div class="sourceCode" id="plot-system"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="plot-system-1"><a href="#plot-system-1"></a>using Gadfly</span>
<span id="plot-system-2"><a href="#plot-system-2"></a>using DataFrames</span>
<span id="plot-system-3"><a href="#plot-system-3"></a></span>
<span id="plot-system-4"><a href="#plot-system-4"></a>struct Label</span>
<span id="plot-system-5"><a href="#plot-system-5"></a>    x :: <span class="dt">Float64</span></span>
<span id="plot-system-6"><a href="#plot-system-6"></a>    y :: <span class="dt">Float64</span></span>
<span id="plot-system-7"><a href="#plot-system-7"></a>    text :: <span class="dt">String</span></span>
<span id="plot-system-8"><a href="#plot-system-8"></a><span class="kw">end</span></span>
<span id="plot-system-9"><a href="#plot-system-9"></a></span>
<span id="plot-system-10"><a href="#plot-system-10"></a>t = collect(<span class="fl">0</span>.:<span class="fl">0.05</span>:<span class="fl">2</span>pi)</span>
<span id="plot-system-11"><a href="#plot-system-11"></a>push!(t, t[<span class="fl">1</span>])</span>
<span id="plot-system-12"><a href="#plot-system-12"></a></span>
<span id="plot-system-13"><a href="#plot-system-13"></a>phi = <span class="fl">3</span>*pi/<span class="fl">5</span></span>
<span id="plot-system-14"><a href="#plot-system-14"></a>u, v = cos(phi), sin(phi)</span>
<span id="plot-system-15"><a href="#plot-system-15"></a>p, q = <span class="fl">2.0</span>, <span class="fl">0.5</span></span>
<span id="plot-system-16"><a href="#plot-system-16"></a></span>
<span id="plot-system-17"><a href="#plot-system-17"></a>label_data = DataFrame([</span>
<span id="plot-system-18"><a href="#plot-system-18"></a>    Label(  -<span class="fl">2.30</span>,  <span class="fl">0.00</span>,  <span class="st">&quot;(u, v)&quot;</span>),</span>
<span id="plot-system-19"><a href="#plot-system-19"></a>    Label(p + <span class="fl">0.1</span>,     q,  <span class="st">&quot;(x, y)&quot;</span>),</span>
<span id="plot-system-20"><a href="#plot-system-20"></a>    Label(   <span class="fl">0.10</span>,  <span class="fl">0.40</span>,  <span class="st">&quot;θ&quot;</span>),</span>
<span id="plot-system-21"><a href="#plot-system-21"></a>    Label(  -<span class="fl">1.30</span>,  <span class="fl">0.75</span>,  <span class="st">&quot;a&quot;</span>),</span>
<span id="plot-system-22"><a href="#plot-system-22"></a>    Label(   <span class="fl">1.00</span>,  <span class="fl">1.00</span>,  <span class="st">&quot;b&quot;</span>)</span>
<span id="plot-system-23"><a href="#plot-system-23"></a>])</span>
<span id="plot-system-24"><a href="#plot-system-24"></a></span>
<span id="plot-system-25"><a href="#plot-system-25"></a>disc = layer(</span>
<span id="plot-system-26"><a href="#plot-system-26"></a>    x=cos.(t), y = sin.(t), Geom.polygon(fill=true), Geom.path,</span>
<span id="plot-system-27"><a href="#plot-system-27"></a>    order=-<span class="fl">1</span>, Theme(alphas=[<span class="fl">0.4</span>]))</span>
<span id="plot-system-28"><a href="#plot-system-28"></a>angle = layer(</span>
<span id="plot-system-29"><a href="#plot-system-29"></a>    x=[<span class="fl">1</span>, <span class="fl">0</span>, u], y=[<span class="fl">0</span>, <span class="fl">0</span>, v], Geom.path,</span>
<span id="plot-system-30"><a href="#plot-system-30"></a>    Theme(default_color=colorant<span class="st">&quot;black&quot;</span>))</span>
<span id="plot-system-31"><a href="#plot-system-31"></a>labels = layer(label_data, x=:x, y=:y, label=:text,</span>
<span id="plot-system-32"><a href="#plot-system-32"></a>    Geom.label, Theme(point_label_font_size=<span class="fl">10</span>pt))</span>
<span id="plot-system-33"><a href="#plot-system-33"></a>elastic = layer(</span>
<span id="plot-system-34"><a href="#plot-system-34"></a>    x=[-<span class="fl">2</span>, u, p], y=[<span class="fl">0.0</span>, v, q], Geom.path, Geom.point,</span>
<span id="plot-system-35"><a href="#plot-system-35"></a>    Theme(default_color=colorant<span class="st">&quot;teal&quot;</span>, line_width=<span class="fl">2</span>pt, point_size=<span class="fl">3</span>pt),</span>
<span id="plot-system-36"><a href="#plot-system-36"></a>    order=<span class="fl">2</span>)</span>
<span id="plot-system-37"><a href="#plot-system-37"></a></span>
<span id="plot-system-38"><a href="#plot-system-38"></a>plt = plot(disc, angle, elastic, labels,</span>
<span id="plot-system-39"><a href="#plot-system-39"></a>     Coord.cartesian(xmin=-<span class="fl">2.5</span>, xmax=<span class="fl">2.5</span>, ymin=-<span class="fl">1.2</span>, ymax=<span class="fl">1.2</span>, fixed=true),</span>
<span id="plot-system-40"><a href="#plot-system-40"></a>     Theme(</span>
<span id="plot-system-41"><a href="#plot-system-41"></a>        panel_fill=colorant<span class="st">&quot;gray90&quot;</span>, key_position=:none,</span>
<span id="plot-system-42"><a href="#plot-system-42"></a>        grid_color=colorant<span class="st">&quot;gray30&quot;</span>, panel_stroke=colorant<span class="st">&quot;black&quot;</span>),</span>
<span id="plot-system-43"><a href="#plot-system-43"></a>     Guide.xticks(ticks=[-<span class="fl">2</span>, -<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>]))</span>
<span id="plot-system-44"><a href="#plot-system-44"></a></span>
<span id="plot-system-45"><a href="#plot-system-45"></a>img = SVG(<span class="st">&quot;system.svg&quot;</span>, <span class="fl">14</span>cm, <span class="fl">7</span>cm)</span>
<span id="plot-system-46"><a href="#plot-system-46"></a>draw(img, plt)</span></code></pre></div>
<h3 id="rendering-svg">Rendering SVG</h3>
<p><em>«import-svg»=</em></p>
<div class="sourceCode" id="import-svg"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="import-svg-1"><a href="#import-svg-1"></a><span class="kw">import</span> <span class="dt">Svg</span> <span class="kw">exposing</span> (<span class="op">..</span>)</span>
<span id="import-svg-2"><a href="#import-svg-2"></a><span class="kw">import</span> <span class="dt">Svg</span><span class="op">.</span><span class="dt">Attributes</span> <span class="kw">exposing</span> (<span class="op">..</span>)</span>
<span id="import-svg-3"><a href="#import-svg-3"></a><span class="kw">import</span> <span class="dt">Svg</span><span class="op">.</span><span class="dt">Events</span> <span class="kw">exposing</span> (<span class="fu">onClick</span>)</span>
<span id="import-svg-4"><a href="#import-svg-4"></a></span>
<span id="import-svg-5"><a href="#import-svg-5"></a><span class="kw">import</span> <span class="dt">Html</span> <span class="kw">exposing</span> (<span class="dt">Html</span>)</span>
<span id="import-svg-6"><a href="#import-svg-6"></a><span class="kw">import</span> <span class="dt">MouseMove</span> <span class="kw">exposing</span> (<span class="fu">onMouseMove</span>)</span></code></pre></div>
<p><em>«machine-render»=</em></p>
<div class="sourceCode" id="machine-render"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="machine-render-1"><a href="#machine-render-1"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">DisplayOptions</span> <span class="op">=</span></span>
<span id="machine-render-2"><a href="#machine-render-2"></a>    { <span class="fu">showPotential</span> : <span class="dt">Bool</span> }</span>
<span id="machine-render-3"><a href="#machine-render-3"></a></span>
<span id="machine-render-4"><a href="#machine-render-4"></a><span class="fu">fromPosition</span> : <span class="dt">Position</span> <span class="op">-&gt;</span> <span class="dt">String</span></span>
<span id="machine-render-5"><a href="#machine-render-5"></a><span class="fu">fromPosition</span> { <span class="fu">x</span><span class="op">,</span> <span class="fu">y</span> } <span class="op">=</span> (<span class="fu">fromFloat</span> <span class="fu">x</span>) <span class="op">++</span> <span class="st">&quot;,&quot;</span> <span class="op">++</span> (<span class="fu">fromFloat</span> <span class="fu">y</span>)</span>
<span id="machine-render-6"><a href="#machine-render-6"></a></span>
<span id="machine-render-7"><a href="#machine-render-7"></a><span class="fu">wheelPosition</span> : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Position</span></span>
<span id="machine-render-8"><a href="#machine-render-8"></a><span class="fu">wheelPosition</span> <span class="fu">theta</span> <span class="op">=</span> { <span class="fu">x</span> <span class="op">=</span> <span class="fu">cos</span> <span class="fu">theta</span><span class="op">,</span> <span class="fu">y</span> <span class="op">=</span> <span class="fu">sin</span> <span class="fu">theta</span> }</span>
<span id="machine-render-9"><a href="#machine-render-9"></a></span>
<span id="machine-render-10"><a href="#machine-render-10"></a><span class="fu">elasticPathString</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">String</span></span>
<span id="machine-render-11"><a href="#machine-render-11"></a><span class="fu">elasticPathString</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></span>
<span id="machine-render-12"><a href="#machine-render-12"></a>    (<span class="fu">fromPosition</span> <span class="fu">f</span>) <span class="op">++</span> <span class="st">&quot; &quot;</span></span>
<span id="machine-render-13"><a href="#machine-render-13"></a>    <span class="op">++</span> (<span class="fu">fromPosition</span> <span class="op">&lt;|</span> <span class="fu">wheelPosition</span> <span class="fu">theta</span>) <span class="op">++</span> <span class="st">&quot; &quot;</span></span>
<span id="machine-render-14"><a href="#machine-render-14"></a>    <span class="op">++</span> (<span class="fu">fromPosition</span> <span class="fu">p</span>)</span>
<span id="machine-render-15"><a href="#machine-render-15"></a></span>
<span id="machine-render-16"><a href="#machine-render-16"></a><span class="fu">pathString</span> : <span class="dt">List</span> (<span class="dt">Float</span><span class="op">,</span> <span class="dt">Float</span>) <span class="op">-&gt;</span> <span class="dt">String</span></span>
<span id="machine-render-17"><a href="#machine-render-17"></a><span class="fu">pathString</span> <span class="fu">pts</span> <span class="op">=</span> <span class="dt">String</span><span class="op">.</span><span class="fu">join</span> <span class="st">&quot; &quot;</span></span>
<span id="machine-render-18"><a href="#machine-render-18"></a>    <span class="op">&lt;|</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ (<span class="fu">x</span><span class="op">,</span> <span class="fu">y</span>) <span class="op">-&gt;</span> (<span class="fu">fromFloat</span> <span class="fu">x</span>) <span class="op">++</span> <span class="st">&quot;,&quot;</span> <span class="op">++</span> (<span class="fu">fromFloat</span> <span class="fu">y</span>)) <span class="fu">pts</span></span>
<span id="machine-render-19"><a href="#machine-render-19"></a></span>
<span id="machine-render-20"><a href="#machine-render-20"></a><span class="fu">potentialPathString</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">String</span></span>
<span id="machine-render-21"><a href="#machine-render-21"></a><span class="fu">potentialPathString</span> <span class="fu">m</span> <span class="op">=</span></span>
<span id="machine-render-22"><a href="#machine-render-22"></a>    <span class="kw">let</span> <span class="fu">pts</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">t</span> <span class="op">-&gt;</span> <span class="fu">fromPolar</span> (<span class="dv">1</span> <span class="op">+</span> <span class="fu">dPotential</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">t</span> }<span class="op">,</span> <span class="fu">t</span>)) <span class="fu">allAngles</span></span>
<span id="machine-render-23"><a href="#machine-render-23"></a>    <span class="kw">in</span> <span class="fu">pathString</span> <span class="fu">pts</span></span>
<span id="machine-render-24"><a href="#machine-render-24"></a></span>
<span id="machine-render-25"><a href="#machine-render-25"></a><span class="fu">discDecoration</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Svg</span> <span class="dt">Msg</span></span>
<span id="machine-render-26"><a href="#machine-render-26"></a><span class="fu">discDecoration</span> <span class="fu">m</span> <span class="op">=</span></span>
<span id="machine-render-27"><a href="#machine-render-27"></a>    <span class="kw">let</span> <span class="fu">outerRim</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">i</span> <span class="op">-&gt;</span> (<span class="dv">0</span><span class="op">.</span><span class="dv">9</span><span class="op">,</span> <span class="fu">t</span> <span class="op">+</span> (<span class="fu">toFloat</span> <span class="fu">i</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="fu">pi</span><span class="op">/</span><span class="dv">80</span>)) (<span class="dt">List</span><span class="op">.</span><span class="fu">range</span> <span class="dv">1</span> <span class="dv">19</span>)</span>
<span id="machine-render-28"><a href="#machine-render-28"></a>        <span class="fu">innerRim</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">i</span> <span class="op">-&gt;</span> (<span class="dv">0</span><span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="fu">t</span> <span class="op">+</span> (<span class="fu">toFloat</span> <span class="fu">i</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="fu">pi</span><span class="op">/</span><span class="dv">20</span>)) (<span class="dt">List</span><span class="op">.</span><span class="fu">range</span> <span class="dv">1</span> <span class="dv">4</span>)</span>
<span id="machine-render-29"><a href="#machine-render-29"></a>        <span class="fu">path</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">append</span> (<span class="dt">List</span><span class="op">.</span><span class="fu">reverse</span> <span class="op">&lt;|</span> <span class="fu">innerRim</span> <span class="fu">t</span>) (<span class="fu">outerRim</span> <span class="fu">t</span>)</span>
<span id="machine-render-30"><a href="#machine-render-30"></a>        <span class="fu">pts</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> <span class="fu">fromPolar</span> (<span class="fu">path</span> <span class="fu">t</span>)</span>
<span id="machine-render-31"><a href="#machine-render-31"></a>        <span class="fu">art</span> <span class="fu">t</span> <span class="op">=</span> <span class="fu">polygon</span> [ <span class="fu">fill</span> <span class="st">&quot;#ffffffcc&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span></span>
<span id="machine-render-32"><a href="#machine-render-32"></a>                        <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">pathString</span> <span class="op">&lt;|</span> <span class="fu">pts</span> <span class="fu">t</span> ] []</span>
<span id="machine-render-33"><a href="#machine-render-33"></a>    <span class="kw">in</span> <span class="fu">g</span> [] [ <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span></span>
<span id="machine-render-34"><a href="#machine-render-34"></a>            <span class="op">,</span> <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span> <span class="op">+</span> <span class="fu">pi</span><span class="op">/</span><span class="dv">2</span></span>
<span id="machine-render-35"><a href="#machine-render-35"></a>            <span class="op">,</span> <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span> <span class="op">+</span> <span class="fu">pi</span></span>
<span id="machine-render-36"><a href="#machine-render-36"></a>            <span class="op">,</span> <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span><span class="fu">pi</span><span class="op">/</span><span class="dv">2</span> ]</span>
<span id="machine-render-37"><a href="#machine-render-37"></a></span>
<span id="machine-render-38"><a href="#machine-render-38"></a><span class="fu">crossHair</span> : <span class="dt">Position</span> <span class="op">-&gt;</span> <span class="dt">Svg</span> <span class="dt">Msg</span></span>
<span id="machine-render-39"><a href="#machine-render-39"></a><span class="fu">crossHair</span> { <span class="fu">x</span><span class="op">,</span> <span class="fu">y</span> } <span class="op">=</span></span>
<span id="machine-render-40"><a href="#machine-render-40"></a>    <span class="fu">g</span> [] [ <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</span>
<span id="machine-render-41"><a href="#machine-render-41"></a>                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</span>
<span id="machine-render-42"><a href="#machine-render-42"></a>                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.04&quot;</span> ] []</span>
<span id="machine-render-43"><a href="#machine-render-43"></a>         <span class="op">,</span> <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)</span>
<span id="machine-render-44"><a href="#machine-render-44"></a>                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)</span>
<span id="machine-render-45"><a href="#machine-render-45"></a>                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.04&quot;</span> ] []</span>
<span id="machine-render-46"><a href="#machine-render-46"></a>         <span class="op">,</span> <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</span>
<span id="machine-render-47"><a href="#machine-render-47"></a>                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</span>
<span id="machine-render-48"><a href="#machine-render-48"></a>                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;white&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span> ] []</span>
<span id="machine-render-49"><a href="#machine-render-49"></a>         <span class="op">,</span> <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)</span>
<span id="machine-render-50"><a href="#machine-render-50"></a>                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)</span>
<span id="machine-render-51"><a href="#machine-render-51"></a>                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;white&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span> ] []</span>
<span id="machine-render-52"><a href="#machine-render-52"></a>         ]</span>
<span id="machine-render-53"><a href="#machine-render-53"></a></span>
<span id="machine-render-54"><a href="#machine-render-54"></a><span class="fu">renderMachine</span> : <span class="dt">DisplayOptions</span> <span class="op">-&gt;</span> <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Html</span> <span class="dt">Msg</span></span>
<span id="machine-render-55"><a href="#machine-render-55"></a><span class="fu">renderMachine</span> <span class="fu">opt</span> <span class="fu">m</span> <span class="op">=</span></span>
<span id="machine-render-56"><a href="#machine-render-56"></a>    <span class="fu">svg</span> [ <span class="fu">width</span> <span class="st">&quot;100%&quot;</span></span>
<span id="machine-render-57"><a href="#machine-render-57"></a>        <span class="op">,</span> <span class="fu">viewBox</span> <span class="st">&quot;-3500 -1500 8000 3000&quot;</span></span>
<span id="machine-render-58"><a href="#machine-render-58"></a>        <span class="op">,</span> <span class="fu">onMouseMove</span> (\ <span class="fu">x</span> <span class="fu">y</span> <span class="op">-&gt;</span> <span class="dt">MouseMove</span> (<span class="dt">Position</span> <span class="fu">x</span> <span class="fu">y</span>))</span>
<span id="machine-render-59"><a href="#machine-render-59"></a>        <span class="op">,</span> <span class="fu">onClick</span> <span class="dt">MouseClick</span> ]</span>
<span id="machine-render-60"><a href="#machine-render-60"></a>        [ <span class="fu">g</span> [ <span class="fu">pointerEvents</span> <span class="st">&quot;bounding-box&quot;</span> ]</span>
<span id="machine-render-61"><a href="#machine-render-61"></a>            [ <span class="fu">rect</span> [ <span class="fu">x</span> <span class="st">&quot;-3500&quot;</span><span class="op">,</span> <span class="fu">y</span> <span class="st">&quot;-1500&quot;</span><span class="op">,</span> <span class="fu">width</span> <span class="st">&quot;8000&quot;</span><span class="op">,</span> <span class="fu">height</span> <span class="st">&quot;3000&quot;</span></span>
<span id="machine-render-62"><a href="#machine-render-62"></a>                   <span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;none&quot;</span> ] [] ]</span>
<span id="machine-render-63"><a href="#machine-render-63"></a>        <span class="op">,</span> <span class="fu">g</span> [ <span class="fu">pointerEvents</span> <span class="st">&quot;none&quot;</span><span class="op">,</span> <span class="fu">transform</span> <span class="st">&quot;scale(1000)&quot;</span> ]</span>
<span id="machine-render-64"><a href="#machine-render-64"></a>            [ <span class="fu">rect</span> [ <span class="fu">x</span> <span class="st">&quot;-3.5&quot;</span><span class="op">,</span> <span class="fu">y</span> <span class="st">&quot;-1.5&quot;</span><span class="op">,</span> <span class="fu">width</span> <span class="st">&quot;8&quot;</span><span class="op">,</span> <span class="fu">height</span> <span class="st">&quot;3&quot;</span></span>
<span id="machine-render-65"><a href="#machine-render-65"></a>                   <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;white&quot;</span> ] []</span>
<span id="machine-render-66"><a href="#machine-render-66"></a>            <span class="op">,</span> <span class="fu">circle</span> [ <span class="fu">cx</span> <span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="fu">cy</span> <span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="fu">r</span> <span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;#ffcc88&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span></span>
<span id="machine-render-67"><a href="#machine-render-67"></a>                     <span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span> ] []</span>
<span id="machine-render-68"><a href="#machine-render-68"></a>            <span class="op">,</span> <span class="fu">discDecoration</span> <span class="fu">m</span></span>
<span id="machine-render-69"><a href="#machine-render-69"></a>            <span class="op">,</span> <span class="fu">polyline</span> [ <span class="fu">fill</span> <span class="st">&quot;none&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;white&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.08&quot;</span></span>
<span id="machine-render-70"><a href="#machine-render-70"></a>                       <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">elasticPathString</span> <span class="fu">m</span> ] []</span>
<span id="machine-render-71"><a href="#machine-render-71"></a>            <span class="op">,</span> <span class="fu">polyline</span> [ <span class="fu">fill</span> <span class="st">&quot;none&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.05&quot;</span></span>
<span id="machine-render-72"><a href="#machine-render-72"></a>                       <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">elasticPathString</span> <span class="fu">m</span> ] []</span>
<span id="machine-render-73"><a href="#machine-render-73"></a>            <span class="op">,</span> <span class="cf">if</span> <span class="fu">opt</span><span class="op">.</span><span class="fu">showPotential</span> <span class="cf">then</span></span>
<span id="machine-render-74"><a href="#machine-render-74"></a>                <span class="fu">polyline</span> [ <span class="fu">fill</span> <span class="st">&quot;#00000022&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span></span>
<span id="machine-render-75"><a href="#machine-render-75"></a>                         <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">potentialPathString</span> <span class="fu">m</span> ] []</span>
<span id="machine-render-76"><a href="#machine-render-76"></a>              <span class="cf">else</span> <span class="fu">g</span> [] []</span>
<span id="machine-render-77"><a href="#machine-render-77"></a>            <span class="op">,</span> <span class="fu">crossHair</span> <span class="fu">m</span><span class="op">.</span><span class="fu">p</span></span>
<span id="machine-render-78"><a href="#machine-render-78"></a>            <span class="op">,</span> <span class="fu">circle</span> [ <span class="fu">cx</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> (<span class="fu">wheelPosition</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span>)<span class="op">.</span><span class="fu">x</span>)</span>
<span id="machine-render-79"><a href="#machine-render-79"></a>                     <span class="op">,</span> <span class="fu">cy</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> (<span class="fu">wheelPosition</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span>)<span class="op">.</span><span class="fu">y</span>)</span>
<span id="machine-render-80"><a href="#machine-render-80"></a>                     <span class="op">,</span> <span class="fu">r</span> <span class="st">&quot;0.07&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;#ffaa88&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span> ] []</span>
<span id="machine-render-81"><a href="#machine-render-81"></a>            <span class="op">,</span> <span class="fu">circle</span> [ <span class="fu">cx</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">f</span><span class="op">.</span><span class="fu">x</span>)<span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span></span>
<span id="machine-render-82"><a href="#machine-render-82"></a>                     <span class="op">,</span> <span class="fu">cy</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">f</span><span class="op">.</span><span class="fu">y</span>)<span class="op">,</span> <span class="fu">r</span> <span class="st">&quot;0.07&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;#ffaa88&quot;</span> ] []</span>
<span id="machine-render-83"><a href="#machine-render-83"></a>            ]</span>
<span id="machine-render-84"><a href="#machine-render-84"></a>        ]</span></code></pre></div>
<h3 id="scaffold">Scaffold</h3>
<p><em>file: «src/Machine.elm»=</em></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">module</span> <span class="dt">Machine</span> <span class="kw">exposing</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>    ( <span class="dt">Machine</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="op">,</span> <span class="dt">DisplayOptions</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="op">,</span> <span class="fu">renderMachine</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="op">,</span> <span class="fu">fromPosition</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="op">,</span> <span class="fu">minimizeMachine</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="op">,</span> <span class="fu">dPotential</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="op">,</span> <span class="fu">d2Potential</span> )</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="op">&lt;&lt;</span><span class="kw">import</span><span class="op">-</span><span class="fu">svg</span><span class="op">&gt;&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="kw">import</span> <span class="dt">String</span> <span class="kw">exposing</span> (<span class="fu">fromFloat</span><span class="op">,</span> <span class="fu">fromInt</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="kw">import</span> <span class="dt">Msg</span> <span class="kw">exposing</span> (<span class="dt">Msg</span>(<span class="op">..</span>)<span class="op">,</span> <span class="dt">Position</span>)</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="op">&lt;&lt;</span><span class="fu">machine</span><span class="op">-</span><span class="fu">datatype</span><span class="op">&gt;&gt;</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="op">&lt;&lt;</span><span class="fu">brentish</span><span class="op">&gt;&gt;</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="op">&lt;&lt;</span><span class="fu">machine</span><span class="op">-</span><span class="fu">render</span><span class="op">&gt;&gt;</span></span></code></pre></div>
<script>
  document.getElementById('myLinks').appendChild(
    document.getElementById('TOC')
  );
</script>
<h1 id="bibliography" class="unnumbered">References</h1>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-Knuth1984">
<p>Knuth, Donald Ervin. 1984. “Literate Programming.” <em>The Computer Journal</em> 27 (2): 97–111.</p>
</div>
<div id="ref-Ramsey1994">
<p>Ramsey, Norman. 1994. “Literate Programming Simplified.” <em>IEEE Software</em> 11 (5): 97–105.</p>
</div>
</div>
</body>
</html>
