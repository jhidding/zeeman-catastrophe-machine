<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Zeeman’s catastrophe machine</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
  <!-- pandoc-eqnos: equation style -->
  <style>
    .eqnos { display: inline-block; position: relative; width: 100%; }
    .eqnos br { display: none; }
    .eqnos-number { position: absolute; right: 0em; top: 50%; line-height: 0; }
  </style>
</head>
<body>
<header>
<h1 class="title">Zeeman’s catastrophe machine</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#problem">Problem</a></li>
<li><a href="#catastrophe-analysis">Catastrophe analysis</a></li>
<li><a href="#numerical-methods">Numerical methods</a><ul>
<li><a href="#updating-the-state">Updating the state</a></li>
<li><a href="#bisection-method">Bisection method</a></li>
<li><a href="#newton-method">Newton method</a></li>
<li><a href="#looping">Looping</a></li>
<li><a href="#initialising-the-search">Initialising the search</a></li>
<li><a href="#updating-the-machine">Updating the machine</a></li>
</ul></li>
<li><a href="#appendix">Appendix</a><ul>
<li><a href="#plotting-the-machine-in-julia">Plotting the machine in Julia</a></li>
<li><a href="#rendering-svg">Rendering SVG</a></li>
<li><a href="#scaffold">Scaffold</a></li>
</ul></li>
</ul>
</nav>
<div id="machine">

</div>
<script src="zeeman.js"></script>
<script>
  Elm.Main.init({ node: document.getElementById("machine") });
</script>
<h2 id="problem">Problem</h2>
<p>We have disk of radius <span class="math inline">\(R\)</span> at the origin, a pin on the edge of this disk at angle <span class="math inline">\(\theta\)</span>, an elastic <span class="math inline">\(a\)</span> from the pin to a fixed point on the <span class="math inline">\(x\)</span>-axis, and another elastic <span class="math inline">\(b\)</span> from the pin to a free moving pointer, see fig. <a href="#fig:system">1</a>.</p>
<div id="fig:system" class="fignos">
<figure>
<img src="system.svg" alt="Figure 1: Zeeman’s catastrophe machine" /><figcaption><span>Figure 1:</span> Zeeman’s catastrophe machine</figcaption>
</figure>
</div>
<p>We define the machine model by the position of the pointer and the angle of the disc.</p>
<p><em>«machine-datatype»=</em></p>
<div class="sourceCode" id="machine-datatype"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="machine-datatype-1" data-line-number="1"><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">Machine</span> <span class="op">=</span></a>
<a class="sourceLine" id="machine-datatype-2" data-line-number="2">    { <span class="fu">f</span>     : <span class="dt">Position</span></a>
<a class="sourceLine" id="machine-datatype-3" data-line-number="3">    <span class="op">,</span> <span class="fu">p</span>     : <span class="dt">Position</span></a>
<a class="sourceLine" id="machine-datatype-4" data-line-number="4">    <span class="op">,</span> <span class="fu">theta</span> : <span class="dt">Float</span></a>
<a class="sourceLine" id="machine-datatype-5" data-line-number="5">    }</a>
<a class="sourceLine" id="machine-datatype-6" data-line-number="6"></a>
<a class="sourceLine" id="machine-datatype-7" data-line-number="7"><span class="op">&lt;&lt;</span><span class="fu">potential</span><span class="op">&gt;&gt;</span></a>
<a class="sourceLine" id="machine-datatype-8" data-line-number="8"><span class="op">&lt;&lt;</span><span class="fu">elastic</span><span class="op">-</span><span class="fu">length</span><span class="op">&gt;&gt;</span></a>
<a class="sourceLine" id="machine-datatype-9" data-line-number="9"><span class="op">&lt;&lt;</span><span class="fu">derivatives</span><span class="op">&gt;&gt;</span></a></code></pre></div>
<p>At each time we need to minimize the potential given the pointer position, taking the current angle as the initial guess. To compute the potential, we model the elastics as linear springs, with a relaxed length of 1.</p>
<p>Let the pointer be at position <span class="math inline">\((x, y)\)</span> and the pinned end at position <span class="math inline">\((u, v)\)</span>, then the total potential energy is</p>
<p><span id="eq:potential-energy" class="eqnos"><span class="math display">\[V \sim \frac{1}{2} \left[ (l_a - 1)^2 + (l_b - 1)^2 \right],\]</span><span class="eqnos-number">(1)</span></span></p>
<p><em>«potential»=</em></p>
<div class="sourceCode" id="potential"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="potential-1" data-line-number="1"><span class="fu">potential</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="potential-2" data-line-number="2"><span class="fu">potential</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></a>
<a class="sourceLine" id="potential-3" data-line-number="3">    <span class="kw">let</span> <span class="fu">l_a</span> <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">f</span> <span class="fu">theta</span></a>
<a class="sourceLine" id="potential-4" data-line-number="4">        <span class="fu">l_b</span> <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span></a>
<a class="sourceLine" id="potential-5" data-line-number="5">    <span class="kw">in</span> ((<span class="fu">l_a</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">l_b</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span></a></code></pre></div>
<p>where</p>
<p><span id="eq:length-a" class="eqnos"><span class="math display">\[l_{a}^2 = (\cos \theta - u)^2 + (\sin \theta - v)^2,\]</span><span class="eqnos-number">(2)</span></span> <span id="eq:length-b" class="eqnos"><span class="math display">\[l_{b}^2 = (\cos \theta - x)^2 + (\sin \theta - y)^2.\]</span><span class="eqnos-number">(3)</span></span></p>
<p><em>«elastic-length»=</em></p>
<div class="sourceCode" id="elastic-length"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="elastic-length-1" data-line-number="1"><span class="fu">elasticLength</span> : <span class="dt">Position</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="elastic-length-2" data-line-number="2"><span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span> <span class="op">=</span></a>
<a class="sourceLine" id="elastic-length-3" data-line-number="3">    <span class="fu">sqrt</span> <span class="op">&lt;|</span> (<span class="fu">cos</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">x</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span>)<span class="op">^</span><span class="dv">2</span></a></code></pre></div>
<p>To compute the minimum it is convenient to have the derivative of the potential.</p>
<p><span id="eq:pd-la" class="eqnos"><span class="math display">\[\frac{\partial l_a}{\partial \theta} = \frac{u\sin\theta - v\cos\theta}{l_a},\]</span><span class="eqnos-number">(4)</span></span> <span id="eq:pd-pot" class="eqnos"><span class="math display">\[\frac{\partial V}{\partial l_a} \sim l_a - 1,\]</span><span class="eqnos-number">(5)</span></span></p>
<p>and similar for <span class="math inline">\(\partial V / \partial l_b\)</span>, which is then enough to construct a function computing <span class="math inline">\(\partial V / \partial \theta\)</span>.</p>
<p><em>«derivatives»=</em></p>
<div class="sourceCode" id="derivatives"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="derivatives-1" data-line-number="1"><span class="fu">dPotential</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="derivatives-2" data-line-number="2"><span class="fu">dPotential</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></a>
<a class="sourceLine" id="derivatives-3" data-line-number="3">    <span class="kw">let</span> <span class="fu">l_a</span>  <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">f</span> <span class="fu">theta</span></a>
<a class="sourceLine" id="derivatives-4" data-line-number="4">        <span class="fu">l_b</span>  <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span></a>
<a class="sourceLine" id="derivatives-5" data-line-number="5">        <span class="fu">d_a</span> <span class="op">=</span> (<span class="fu">f</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">f</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_a</span></a>
<a class="sourceLine" id="derivatives-6" data-line-number="6">        <span class="fu">d_b</span> <span class="op">=</span> (<span class="fu">p</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_b</span></a>
<a class="sourceLine" id="derivatives-7" data-line-number="7">    <span class="kw">in</span> (<span class="fu">l_a</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">d_a</span> <span class="op">+</span> (<span class="fu">l_b</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">d_b</span></a></code></pre></div>
<p>Since we’ll use the Newton method to find the roots in the derivative, we’ll also need the second derivative. Noting that,</p>
<p><span class="math display">\[\partial_{t}f = \partial_{a}f \partial_{t}a,\]</span> <span class="math display">\[\partial_{tt}f = \partial_{aa}f(\partial_t a)^2 + \partial_a f \partial_{tt} a,\]</span></p>
<p><span class="math display">\[\frac{\partial^2 l_a}{\partial \theta^2} = \frac{u\cos\theta + v\sin\theta - (\partial l_a / \partial \theta)^2}{l_a},\]</span></p>
<p>and</p>
<p><span class="math display">\[\frac{\partial^2 V}{\partial l_a} = 1.\]</span></p>
<p><em>«derivatives»=+</em></p>
<div class="sourceCode" id="derivatives"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="derivatives-1" data-line-number="1"><span class="fu">d2Potential</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="derivatives-2" data-line-number="2"><span class="fu">d2Potential</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></a>
<a class="sourceLine" id="derivatives-3" data-line-number="3">    <span class="kw">let</span> <span class="fu">l_a</span>   <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">f</span> <span class="fu">theta</span></a>
<a class="sourceLine" id="derivatives-4" data-line-number="4">        <span class="fu">l_b</span>   <span class="op">=</span> <span class="fu">elasticLength</span> <span class="fu">p</span> <span class="fu">theta</span></a>
<a class="sourceLine" id="derivatives-5" data-line-number="5">        <span class="fu">d_a</span>   <span class="op">=</span> (<span class="fu">f</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">f</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_a</span></a>
<a class="sourceLine" id="derivatives-6" data-line-number="6">        <span class="fu">d_b</span>   <span class="op">=</span> (<span class="fu">p</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">sin</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span>) <span class="op">/</span> <span class="fu">l_b</span></a>
<a class="sourceLine" id="derivatives-7" data-line-number="7">        <span class="fu">dd_a</span>  <span class="op">=</span> (<span class="fu">f</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">+</span> <span class="fu">f</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">d_a</span><span class="op">^</span><span class="dv">2</span>) <span class="op">/</span> <span class="fu">l_a</span></a>
<a class="sourceLine" id="derivatives-8" data-line-number="8">        <span class="fu">dd_b</span>  <span class="op">=</span> (<span class="fu">p</span><span class="op">.</span><span class="fu">x</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">+</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">cos</span> <span class="fu">theta</span> <span class="op">-</span> <span class="fu">d_b</span><span class="op">^</span><span class="dv">2</span>) <span class="op">/</span> <span class="fu">l_b</span></a>
<a class="sourceLine" id="derivatives-9" data-line-number="9">    <span class="kw">in</span> <span class="fu">d_a</span><span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">l_a</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">dd_a</span> <span class="op">+</span> <span class="fu">d_b</span><span class="op">^</span><span class="dv">2</span> <span class="op">+</span> (<span class="fu">l_b</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fu">dd_b</span></a></code></pre></div>
<h2 id="catastrophe-analysis">Catastrophe analysis</h2>
<h2 id="numerical-methods">Numerical methods</h2>
<p>There are two methods that we will use to find the minimum of the potential: Newton and bisection. Newton’s method converges faster if we’re close to a minimum, but if the we’re far away, particularly somewhere where the slope of the potential is shallow, Newton behaves bad. This solution maintains an interval that straps the minimum inside. If the Newton method wants to exit this interval, we revert to bisection.</p>
<p>This method is similar to the Brent method which is a hybrid between bisection and secant method.</p>
<p>For visualisation purposes an <span class="math inline">\(\epsilon\)</span> of <span class="math inline">\(0.001\)</span> should suffice.</p>
<p><em>«brentish»=</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">epsilon</span> : <span class="dt">Float</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">epsilon</span> <span class="op">=</span> <span class="dv">0</span><span class="op">.</span><span class="dv">001</span></a></code></pre></div>
<p>We make sure that we always move down hill. This way we’ll never end up on a maximum. Now and then we have to check the sign of the first derivative to enforce this.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">signOf</span> : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">signOf</span> <span class="fu">x</span> <span class="op">=</span> <span class="cf">if</span> <span class="fu">x</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="cf">if</span> <span class="fu">x</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">then</span> <span class="op">-</span><span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span></a></code></pre></div>
<p>We keep a minimalisation state inside a record, to prevent overly long lists of function arguments. The two elements <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> always straddle the minimum, where <span class="math inline">\(b\)</span> is the last computed value.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="kw">type</span> <span class="dt">IterationMethod</span> <span class="op">=</span> <span class="dt">Guess</span> <span class="op">|</span> <span class="dt">Bisect</span> <span class="op">|</span> <span class="dt">Newton</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">Phase</span> <span class="op">=</span> { <span class="fu">x</span> : <span class="dt">Float</span><span class="op">,</span> <span class="fu">y</span> : <span class="dt">Float</span><span class="op">,</span> <span class="fu">dy</span> : <span class="dt">Float</span> }</a>
<a class="sourceLine" id="brentish-3" data-line-number="3"><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">MinState</span> <span class="op">=</span></a>
<a class="sourceLine" id="brentish-4" data-line-number="4">    { <span class="fu">f</span>    : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="brentish-5" data-line-number="5">    <span class="op">,</span> <span class="fu">df</span>   : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="brentish-6" data-line-number="6">    <span class="op">,</span> <span class="fu">a</span>    : <span class="dt">Phase</span></a>
<a class="sourceLine" id="brentish-7" data-line-number="7">    <span class="op">,</span> <span class="fu">b</span>    : <span class="dt">Phase</span></a>
<a class="sourceLine" id="brentish-8" data-line-number="8">    <span class="op">,</span> <span class="fu">last</span> : <span class="dt">IterationMethod</span> }</a></code></pre></div>
<p>The triple <span class="math inline">\(x\)</span>, <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(f&#39;(x)\)</span> are dubbed <em>phase</em>.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">phase</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Phase</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span> <span class="op">=</span> <span class="dt">Phase</span> <span class="fu">x</span> (<span class="fu">s</span><span class="op">.</span><span class="fu">f</span> <span class="fu">x</span>) (<span class="fu">s</span><span class="op">.</span><span class="fu">df</span> <span class="fu">x</span>)</a></code></pre></div>
<h3 id="updating-the-state">Updating the state</h3>
<p>The state is updated such that the points <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> always stradle the minimum and <span class="math inline">\(b\)</span> is the last computed point.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">intersect</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Phase</span> <span class="op">-&gt;</span> <span class="dt">MinState</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">intersect</span> <span class="fu">s</span> <span class="fu">p</span> <span class="op">=</span></a>
<a class="sourceLine" id="brentish-3" data-line-number="3">    <span class="cf">if</span> <span class="fu">p</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">s</span><span class="op">.</span><span class="fu">a</span><span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">then</span></a>
<a class="sourceLine" id="brentish-4" data-line-number="4">        {<span class="fu">s</span> <span class="op">|</span> <span class="fu">b</span> <span class="op">=</span> <span class="fu">p</span> }</a>
<a class="sourceLine" id="brentish-5" data-line-number="5">    <span class="cf">else</span></a>
<a class="sourceLine" id="brentish-6" data-line-number="6">        {<span class="fu">s</span> <span class="op">|</span> <span class="fu">a</span> <span class="op">=</span> <span class="fu">s</span><span class="op">.</span><span class="fu">b</span><span class="op">,</span> <span class="fu">b</span> <span class="op">=</span> <span class="fu">p</span> }</a></code></pre></div>
<h3 id="bisection-method">Bisection method</h3>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">bisection</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">MinState</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">bisection</span> ({ <span class="fu">f</span><span class="op">,</span> <span class="fu">df</span><span class="op">,</span> <span class="fu">a</span><span class="op">,</span> <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="op">=</span></a>
<a class="sourceLine" id="brentish-3" data-line-number="3">    <span class="kw">let</span> <span class="fu">x</span> <span class="op">=</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span>) <span class="op">/</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span>)</a>
<a class="sourceLine" id="brentish-4" data-line-number="4">    <span class="kw">in</span> <span class="fu">intersect</span> { <span class="fu">s</span> <span class="op">|</span> <span class="fu">last</span> <span class="op">=</span> <span class="dt">Bisect</span> } <span class="op">&lt;|</span> <span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span></a></code></pre></div>
<h3 id="newton-method">Newton method</h3>
<p>The Newton method is accepted only if the result is inside the interval. Otherwise we revert to bisection. This implementation is different from ordinary root-finding Newton method, in that it only searches in a down-hill direction.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">inside</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">inside</span> { <span class="fu">a</span><span class="op">,</span> <span class="fu">b</span> } <span class="fu">x</span> <span class="op">=</span></a>
<a class="sourceLine" id="brentish-3" data-line-number="3">    <span class="kw">let</span> <span class="fu">d</span> <span class="op">=</span> <span class="fu">abs</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span>)</a>
<a class="sourceLine" id="brentish-4" data-line-number="4">    <span class="kw">in</span> <span class="fu">abs</span> (<span class="fu">x</span> <span class="op">-</span> <span class="fu">a</span><span class="op">.</span><span class="fu">x</span>) <span class="op">&lt;</span> <span class="fu">d</span> <span class="op">&amp;&amp;</span> <span class="fu">abs</span> (<span class="fu">x</span> <span class="op">-</span> <span class="fu">b</span><span class="op">.</span><span class="fu">x</span>) <span class="op">&lt;</span> <span class="fu">d</span></a>
<a class="sourceLine" id="brentish-5" data-line-number="5"></a>
<a class="sourceLine" id="brentish-6" data-line-number="6"><span class="fu">newton</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">MinState</span></a>
<a class="sourceLine" id="brentish-7" data-line-number="7"><span class="fu">newton</span> ({ <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="op">=</span></a>
<a class="sourceLine" id="brentish-8" data-line-number="8">    <span class="kw">let</span> <span class="fu">sign</span>       <span class="op">=</span> <span class="fu">signOf</span> <span class="fu">b</span><span class="op">.</span><span class="fu">y</span></a>
<a class="sourceLine" id="brentish-9" data-line-number="9">        <span class="fu">x</span>          <span class="op">=</span> <span class="fu">b</span><span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fu">sign</span> <span class="op">*</span> <span class="fu">abs</span> (<span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="fu">b</span><span class="op">.</span><span class="fu">dy</span>)</a>
<a class="sourceLine" id="brentish-10" data-line-number="10">    <span class="kw">in</span> <span class="cf">if</span> <span class="fu">inside</span> <span class="fu">s</span> <span class="fu">x</span> <span class="cf">then</span></a>
<a class="sourceLine" id="brentish-11" data-line-number="11">        <span class="fu">intersect</span> { <span class="fu">s</span> <span class="op">|</span> <span class="fu">last</span> <span class="op">=</span> <span class="dt">Newton</span> } <span class="op">&lt;|</span> <span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span></a>
<a class="sourceLine" id="brentish-12" data-line-number="12">    <span class="cf">else</span></a>
<a class="sourceLine" id="brentish-13" data-line-number="13">        <span class="fu">bisection</span> <span class="fu">s</span></a></code></pre></div>
<h3 id="looping">Looping</h3>
<p>The <code>findRoot</code> function is a generic function that keeps iterating on <code>newton</code> until a sattisfying result is found. This function is generic and should work for any input function.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">findRoot</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">findRoot</span> ({ <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="op">=</span></a>
<a class="sourceLine" id="brentish-3" data-line-number="3">    <span class="cf">if</span> <span class="fu">abs</span> <span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="fu">epsilon</span> <span class="cf">then</span></a>
<a class="sourceLine" id="brentish-4" data-line-number="4">        <span class="fu">b</span><span class="op">.</span><span class="fu">x</span></a>
<a class="sourceLine" id="brentish-5" data-line-number="5">    <span class="cf">else</span></a>
<a class="sourceLine" id="brentish-6" data-line-number="6">        <span class="fu">findRoot</span> (<span class="fu">newton</span> <span class="fu">s</span>)</a></code></pre></div>
<p>There is some more specialisation in how we initialise the search, finding an interval that should give us a good result.</p>
<h3 id="initialising-the-search">Initialising the search</h3>
<p>The first task is to find a pair of numbers <span class="math inline">\(x_a\)</span> and <span class="math inline">\(x_b\)</span> for which there is a root in <span class="math inline">\(f\)</span> for a value between <span class="math inline">\(x_a\)</span> and <span class="math inline">\(x_b\)</span>. Second criterium is that the derivatives of <span class="math inline">\(f\)</span> don’t change sign in the interval. If we’re close to an inflection point, which will happen a lot in this application, no such interval may exist. In that case we don’t change anything. Since we operate on a periodic space we’ll give a finite list of candidate intervals.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">bracket</span> : <span class="dt">MinState</span> <span class="op">-&gt;</span> <span class="dt">List</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">MinState</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">bracket</span> ({ <span class="fu">f</span><span class="op">,</span> <span class="fu">df</span><span class="op">,</span> <span class="fu">a</span><span class="op">,</span> <span class="fu">b</span> } <span class="kw">as</span> <span class="fu">s</span>) <span class="fu">qs</span> <span class="op">=</span> <span class="cf">case</span> <span class="fu">qs</span> <span class="cf">of</span></a>
<a class="sourceLine" id="brentish-3" data-line-number="3">    []        <span class="op">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="brentish-4" data-line-number="4">    (<span class="fu">x</span> <span class="op">::</span> <span class="fu">xs</span>) <span class="op">-&gt;</span> <span class="cf">if</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span> <span class="op">*</span> <span class="fu">b</span><span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="fu">a</span><span class="op">.</span><span class="fu">dy</span> <span class="op">*</span> <span class="fu">b</span><span class="op">.</span><span class="fu">dy</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">then</span></a>
<a class="sourceLine" id="brentish-5" data-line-number="5">                    <span class="dt">Just</span> <span class="fu">s</span></a>
<a class="sourceLine" id="brentish-6" data-line-number="6">                 <span class="cf">else</span></a>
<a class="sourceLine" id="brentish-7" data-line-number="7">                    <span class="fu">bracket</span> { <span class="fu">s</span> <span class="op">|</span> <span class="fu">a</span> <span class="op">=</span> <span class="fu">b</span><span class="op">,</span> <span class="fu">b</span> <span class="op">=</span> <span class="fu">phase</span> <span class="fu">s</span> <span class="fu">x</span> } <span class="fu">xs</span></a></code></pre></div>
<p>We feed the <code>bracket</code> function a list of angles.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">allAngles</span> : <span class="dt">List</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">allAngles</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">i</span> <span class="op">-&gt;</span> (<span class="fu">toFloat</span> <span class="fu">i</span>) <span class="op">*</span> <span class="dv">2</span><span class="op">.</span><span class="dv">0</span> <span class="op">*</span> <span class="fu">pi</span> <span class="op">/</span> <span class="dv">100</span>) (<span class="dt">List</span><span class="op">.</span><span class="fu">range</span> <span class="dv">0</span> <span class="dv">100</span>)</a></code></pre></div>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">initMin</span> : (<span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span>) <span class="op">-&gt;</span> (<span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span>) <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">MinState</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">initMin</span> <span class="fu">f</span> <span class="fu">df</span> <span class="fu">x</span> <span class="op">=</span></a>
<a class="sourceLine" id="brentish-3" data-line-number="3">    <span class="kw">let</span> <span class="fu">a</span> <span class="op">=</span> <span class="dt">Phase</span> <span class="fu">x</span> (<span class="fu">f</span> <span class="fu">x</span>) (<span class="fu">df</span> <span class="fu">x</span>)</a>
<a class="sourceLine" id="brentish-4" data-line-number="4">        <span class="fu">s</span> <span class="op">=</span> <span class="dt">MinState</span> <span class="fu">f</span> <span class="fu">df</span> <span class="fu">a</span> <span class="fu">a</span> <span class="dt">Guess</span></a>
<a class="sourceLine" id="brentish-5" data-line-number="5">        <span class="fu">sign</span> <span class="op">=</span> <span class="fu">signOf</span> <span class="fu">a</span><span class="op">.</span><span class="fu">y</span></a>
<a class="sourceLine" id="brentish-6" data-line-number="6">    <span class="kw">in</span> <span class="fu">bracket</span> <span class="fu">s</span> <span class="op">&lt;|</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">theta</span> <span class="op">-&gt;</span> <span class="fu">x</span> <span class="op">-</span> <span class="fu">sign</span> <span class="op">*</span> <span class="fu">theta</span>) <span class="fu">allAngles</span></a></code></pre></div>
<h3 id="updating-the-machine">Updating the machine</h3>
<p>In updating the machine state, the last step is to retrieve a value between <span class="math inline">\(0\)</span> and <span class="math inline">\(2\pi\)</span>. This step is not essential, but it keeps me sane.</p>
<p><em>«brentish»=+</em></p>
<div class="sourceCode" id="brentish"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="brentish-1" data-line-number="1"><span class="fu">modulo</span> : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="brentish-2" data-line-number="2"><span class="fu">modulo</span> <span class="fu">x</span> <span class="fu">m</span> <span class="op">=</span> <span class="fu">x</span> <span class="op">-</span> (<span class="fu">toFloat</span> <span class="op">&lt;|</span> <span class="fu">floor</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">/</span> <span class="fu">m</span>) <span class="op">*</span> <span class="fu">m</span></a>
<a class="sourceLine" id="brentish-3" data-line-number="3"></a>
<a class="sourceLine" id="brentish-4" data-line-number="4"><span class="fu">minimizeMachine</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Machine</span></a>
<a class="sourceLine" id="brentish-5" data-line-number="5"><span class="fu">minimizeMachine</span> <span class="fu">m</span> <span class="op">=</span></a>
<a class="sourceLine" id="brentish-6" data-line-number="6">    <span class="kw">let</span> <span class="fu">f</span>  <span class="op">=</span> \ <span class="fu">theta</span> <span class="op">-&gt;</span> <span class="fu">dPotential</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">theta</span> }</a>
<a class="sourceLine" id="brentish-7" data-line-number="7">        <span class="fu">df</span> <span class="op">=</span> \ <span class="fu">theta</span> <span class="op">-&gt;</span> <span class="fu">d2Potential</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">theta</span> }</a>
<a class="sourceLine" id="brentish-8" data-line-number="8">        <span class="fu">ms</span>  <span class="op">=</span> <span class="fu">initMin</span> <span class="fu">f</span> <span class="fu">df</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span></a>
<a class="sourceLine" id="brentish-9" data-line-number="9">    <span class="kw">in</span> <span class="cf">case</span> <span class="fu">ms</span> <span class="cf">of</span></a>
<a class="sourceLine" id="brentish-10" data-line-number="10">        <span class="dt">Just</span> <span class="fu">s</span>  <span class="op">-&gt;</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">modulo</span> (<span class="fu">findRoot</span> <span class="fu">s</span>) (<span class="dv">2</span> <span class="op">*</span> <span class="fu">pi</span>) }</a>
<a class="sourceLine" id="brentish-11" data-line-number="11">        <span class="dt">Nothing</span> <span class="op">-&gt;</span> <span class="fu">m</span></a></code></pre></div>
<h2 id="appendix">Appendix</h2>
<h3 id="plotting-the-machine-in-julia">Plotting the machine in Julia</h3>
<p><em>«plot-system»=</em></p>
<div class="sourceCode" id="plot-system"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="plot-system-1" data-line-number="1">using Gadfly</a>
<a class="sourceLine" id="plot-system-2" data-line-number="2">using DataFrames</a>
<a class="sourceLine" id="plot-system-3" data-line-number="3"></a>
<a class="sourceLine" id="plot-system-4" data-line-number="4">struct Label</a>
<a class="sourceLine" id="plot-system-5" data-line-number="5">    x :: <span class="dt">Float64</span></a>
<a class="sourceLine" id="plot-system-6" data-line-number="6">    y :: <span class="dt">Float64</span></a>
<a class="sourceLine" id="plot-system-7" data-line-number="7">    text :: <span class="dt">String</span></a>
<a class="sourceLine" id="plot-system-8" data-line-number="8"><span class="kw">end</span></a>
<a class="sourceLine" id="plot-system-9" data-line-number="9"></a>
<a class="sourceLine" id="plot-system-10" data-line-number="10">t = collect(<span class="fl">0</span>.:<span class="fl">0.05</span>:<span class="fl">2</span>pi)</a>
<a class="sourceLine" id="plot-system-11" data-line-number="11">push!(t, t[<span class="fl">1</span>])</a>
<a class="sourceLine" id="plot-system-12" data-line-number="12"></a>
<a class="sourceLine" id="plot-system-13" data-line-number="13">phi = <span class="fl">3</span>*pi/<span class="fl">5</span></a>
<a class="sourceLine" id="plot-system-14" data-line-number="14">u, v = cos(phi), sin(phi)</a>
<a class="sourceLine" id="plot-system-15" data-line-number="15">p, q = <span class="fl">2.0</span>, <span class="fl">0.5</span></a>
<a class="sourceLine" id="plot-system-16" data-line-number="16"></a>
<a class="sourceLine" id="plot-system-17" data-line-number="17">label_data = DataFrame([</a>
<a class="sourceLine" id="plot-system-18" data-line-number="18">    Label(  -<span class="fl">2.30</span>,  <span class="fl">0.00</span>,  <span class="st">&quot;(u, v)&quot;</span>),</a>
<a class="sourceLine" id="plot-system-19" data-line-number="19">    Label(p + <span class="fl">0.1</span>,     q,  <span class="st">&quot;(x, y)&quot;</span>),</a>
<a class="sourceLine" id="plot-system-20" data-line-number="20">    Label(   <span class="fl">0.10</span>,  <span class="fl">0.40</span>,  <span class="st">&quot;θ&quot;</span>),</a>
<a class="sourceLine" id="plot-system-21" data-line-number="21">    Label(  -<span class="fl">1.30</span>,  <span class="fl">0.75</span>,  <span class="st">&quot;a&quot;</span>),</a>
<a class="sourceLine" id="plot-system-22" data-line-number="22">    Label(   <span class="fl">1.00</span>,  <span class="fl">1.00</span>,  <span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="plot-system-23" data-line-number="23">])</a>
<a class="sourceLine" id="plot-system-24" data-line-number="24"></a>
<a class="sourceLine" id="plot-system-25" data-line-number="25">disc = layer(</a>
<a class="sourceLine" id="plot-system-26" data-line-number="26">    x=cos.(t), y = sin.(t), Geom.polygon(fill=true), Geom.path,</a>
<a class="sourceLine" id="plot-system-27" data-line-number="27">    order=-<span class="fl">1</span>, Theme(alphas=[<span class="fl">0.4</span>]))</a>
<a class="sourceLine" id="plot-system-28" data-line-number="28">angle = layer(</a>
<a class="sourceLine" id="plot-system-29" data-line-number="29">    x=[<span class="fl">1</span>, <span class="fl">0</span>, u], y=[<span class="fl">0</span>, <span class="fl">0</span>, v], Geom.path,</a>
<a class="sourceLine" id="plot-system-30" data-line-number="30">    Theme(default_color=colorant<span class="st">&quot;black&quot;</span>))</a>
<a class="sourceLine" id="plot-system-31" data-line-number="31">labels = layer(label_data, x=:x, y=:y, label=:text,</a>
<a class="sourceLine" id="plot-system-32" data-line-number="32">    Geom.label, Theme(point_label_font_size=<span class="fl">10</span>pt))</a>
<a class="sourceLine" id="plot-system-33" data-line-number="33">elastic = layer(</a>
<a class="sourceLine" id="plot-system-34" data-line-number="34">    x=[-<span class="fl">2</span>, u, p], y=[<span class="fl">0.0</span>, v, q], Geom.path, Geom.point,</a>
<a class="sourceLine" id="plot-system-35" data-line-number="35">    Theme(default_color=colorant<span class="st">&quot;teal&quot;</span>, line_width=<span class="fl">2</span>pt, point_size=<span class="fl">3</span>pt),</a>
<a class="sourceLine" id="plot-system-36" data-line-number="36">    order=<span class="fl">2</span>)</a>
<a class="sourceLine" id="plot-system-37" data-line-number="37"></a>
<a class="sourceLine" id="plot-system-38" data-line-number="38">plt = plot(disc, angle, elastic, labels,</a>
<a class="sourceLine" id="plot-system-39" data-line-number="39">     Coord.cartesian(xmin=-<span class="fl">2.5</span>, xmax=<span class="fl">2.5</span>, ymin=-<span class="fl">1.2</span>, ymax=<span class="fl">1.2</span>, fixed=true),</a>
<a class="sourceLine" id="plot-system-40" data-line-number="40">     Theme(</a>
<a class="sourceLine" id="plot-system-41" data-line-number="41">        panel_fill=colorant<span class="st">&quot;gray90&quot;</span>, key_position=:none,</a>
<a class="sourceLine" id="plot-system-42" data-line-number="42">        grid_color=colorant<span class="st">&quot;gray30&quot;</span>, panel_stroke=colorant<span class="st">&quot;black&quot;</span>),</a>
<a class="sourceLine" id="plot-system-43" data-line-number="43">     Guide.xticks(ticks=[-<span class="fl">2</span>, -<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>]))</a>
<a class="sourceLine" id="plot-system-44" data-line-number="44"></a>
<a class="sourceLine" id="plot-system-45" data-line-number="45">img = SVG(<span class="st">&quot;system.svg&quot;</span>, <span class="fl">14</span>cm, <span class="fl">7</span>cm)</a>
<a class="sourceLine" id="plot-system-46" data-line-number="46">draw(img, plt)</a></code></pre></div>
<h3 id="rendering-svg">Rendering SVG</h3>
<p><em>«import-svg»=</em></p>
<div class="sourceCode" id="import-svg"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="import-svg-1" data-line-number="1"><span class="kw">import</span> <span class="dt">Svg</span> <span class="kw">exposing</span> (<span class="op">..</span>)</a>
<a class="sourceLine" id="import-svg-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Svg</span><span class="op">.</span><span class="dt">Attributes</span> <span class="kw">exposing</span> (<span class="op">..</span>)</a>
<a class="sourceLine" id="import-svg-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Svg</span><span class="op">.</span><span class="dt">Events</span> <span class="kw">exposing</span> (<span class="fu">onClick</span>)</a>
<a class="sourceLine" id="import-svg-4" data-line-number="4"></a>
<a class="sourceLine" id="import-svg-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Html</span> <span class="kw">exposing</span> (<span class="dt">Html</span>)</a>
<a class="sourceLine" id="import-svg-6" data-line-number="6"><span class="kw">import</span> <span class="dt">MouseMove</span> <span class="kw">exposing</span> (<span class="fu">onMouseMove</span>)</a></code></pre></div>
<p><em>«machine-render»=</em></p>
<div class="sourceCode" id="machine-render"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="machine-render-1" data-line-number="1"><span class="fu">fromPosition</span> : <span class="dt">Position</span> <span class="op">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="machine-render-2" data-line-number="2"><span class="fu">fromPosition</span> { <span class="fu">x</span><span class="op">,</span> <span class="fu">y</span> } <span class="op">=</span> (<span class="fu">fromFloat</span> <span class="fu">x</span>) <span class="op">++</span> <span class="st">&quot;,&quot;</span> <span class="op">++</span> (<span class="fu">fromFloat</span> <span class="fu">y</span>)</a>
<a class="sourceLine" id="machine-render-3" data-line-number="3"></a>
<a class="sourceLine" id="machine-render-4" data-line-number="4"><span class="fu">wheelPosition</span> : <span class="dt">Float</span> <span class="op">-&gt;</span> <span class="dt">Position</span></a>
<a class="sourceLine" id="machine-render-5" data-line-number="5"><span class="fu">wheelPosition</span> <span class="fu">theta</span> <span class="op">=</span> { <span class="fu">x</span> <span class="op">=</span> <span class="fu">cos</span> <span class="fu">theta</span><span class="op">,</span> <span class="fu">y</span> <span class="op">=</span> <span class="fu">sin</span> <span class="fu">theta</span> }</a>
<a class="sourceLine" id="machine-render-6" data-line-number="6"></a>
<a class="sourceLine" id="machine-render-7" data-line-number="7"><span class="fu">elasticPathString</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="machine-render-8" data-line-number="8"><span class="fu">elasticPathString</span> { <span class="fu">f</span><span class="op">,</span> <span class="fu">p</span><span class="op">,</span> <span class="fu">theta</span> } <span class="op">=</span></a>
<a class="sourceLine" id="machine-render-9" data-line-number="9">    (<span class="fu">fromPosition</span> <span class="fu">f</span>) <span class="op">++</span> <span class="st">&quot; &quot;</span></a>
<a class="sourceLine" id="machine-render-10" data-line-number="10">    <span class="op">++</span> (<span class="fu">fromPosition</span> <span class="op">&lt;|</span> <span class="fu">wheelPosition</span> <span class="fu">theta</span>) <span class="op">++</span> <span class="st">&quot; &quot;</span></a>
<a class="sourceLine" id="machine-render-11" data-line-number="11">    <span class="op">++</span> (<span class="fu">fromPosition</span> <span class="fu">p</span>)</a>
<a class="sourceLine" id="machine-render-12" data-line-number="12"></a>
<a class="sourceLine" id="machine-render-13" data-line-number="13"><span class="fu">pathString</span> : <span class="dt">List</span> (<span class="dt">Float</span><span class="op">,</span> <span class="dt">Float</span>) <span class="op">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="machine-render-14" data-line-number="14"><span class="fu">pathString</span> <span class="fu">pts</span> <span class="op">=</span> <span class="dt">String</span><span class="op">.</span><span class="fu">join</span> <span class="st">&quot; &quot;</span></a>
<a class="sourceLine" id="machine-render-15" data-line-number="15">    <span class="op">&lt;|</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ (<span class="fu">x</span><span class="op">,</span> <span class="fu">y</span>) <span class="op">-&gt;</span> (<span class="fu">fromFloat</span> <span class="fu">x</span>) <span class="op">++</span> <span class="st">&quot;,&quot;</span> <span class="op">++</span> (<span class="fu">fromFloat</span> <span class="fu">y</span>)) <span class="fu">pts</span></a>
<a class="sourceLine" id="machine-render-16" data-line-number="16"></a>
<a class="sourceLine" id="machine-render-17" data-line-number="17"><span class="fu">potentialPathString</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="machine-render-18" data-line-number="18"><span class="fu">potentialPathString</span> <span class="fu">m</span> <span class="op">=</span></a>
<a class="sourceLine" id="machine-render-19" data-line-number="19">    <span class="kw">let</span> <span class="fu">pts</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">t</span> <span class="op">-&gt;</span> <span class="fu">fromPolar</span> (<span class="dv">1</span> <span class="op">+</span> <span class="fu">dPotential</span> { <span class="fu">m</span> <span class="op">|</span> <span class="fu">theta</span> <span class="op">=</span> <span class="fu">t</span> }<span class="op">,</span> <span class="fu">t</span>)) <span class="fu">allAngles</span></a>
<a class="sourceLine" id="machine-render-20" data-line-number="20">    <span class="kw">in</span> <span class="fu">pathString</span> <span class="fu">pts</span></a>
<a class="sourceLine" id="machine-render-21" data-line-number="21"></a>
<a class="sourceLine" id="machine-render-22" data-line-number="22"><span class="fu">discDecoration</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Svg</span> <span class="dt">Msg</span></a>
<a class="sourceLine" id="machine-render-23" data-line-number="23"><span class="fu">discDecoration</span> <span class="fu">m</span> <span class="op">=</span></a>
<a class="sourceLine" id="machine-render-24" data-line-number="24">    <span class="kw">let</span> <span class="fu">outerRim</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">i</span> <span class="op">-&gt;</span> (<span class="dv">0</span><span class="op">.</span><span class="dv">9</span><span class="op">,</span> <span class="fu">t</span> <span class="op">+</span> (<span class="fu">toFloat</span> <span class="fu">i</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="fu">pi</span><span class="op">/</span><span class="dv">80</span>)) (<span class="dt">List</span><span class="op">.</span><span class="fu">range</span> <span class="dv">1</span> <span class="dv">19</span>)</a>
<a class="sourceLine" id="machine-render-25" data-line-number="25">        <span class="fu">innerRim</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> (\ <span class="fu">i</span> <span class="op">-&gt;</span> (<span class="dv">0</span><span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="fu">t</span> <span class="op">+</span> (<span class="fu">toFloat</span> <span class="fu">i</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="fu">pi</span><span class="op">/</span><span class="dv">20</span>)) (<span class="dt">List</span><span class="op">.</span><span class="fu">range</span> <span class="dv">1</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="machine-render-26" data-line-number="26">        <span class="fu">path</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">append</span> (<span class="dt">List</span><span class="op">.</span><span class="fu">reverse</span> <span class="op">&lt;|</span> <span class="fu">innerRim</span> <span class="fu">t</span>) (<span class="fu">outerRim</span> <span class="fu">t</span>)</a>
<a class="sourceLine" id="machine-render-27" data-line-number="27">        <span class="fu">pts</span> <span class="fu">t</span> <span class="op">=</span> <span class="dt">List</span><span class="op">.</span><span class="fu">map</span> <span class="fu">fromPolar</span> (<span class="fu">path</span> <span class="fu">t</span>)</a>
<a class="sourceLine" id="machine-render-28" data-line-number="28">        <span class="fu">art</span> <span class="fu">t</span> <span class="op">=</span> <span class="fu">polygon</span> [ <span class="fu">fill</span> <span class="st">&quot;#ffffffcc&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span></a>
<a class="sourceLine" id="machine-render-29" data-line-number="29">                        <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">pathString</span> <span class="op">&lt;|</span> <span class="fu">pts</span> <span class="fu">t</span> ] []</a>
<a class="sourceLine" id="machine-render-30" data-line-number="30">    <span class="kw">in</span> <span class="fu">g</span> [] [ <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span></a>
<a class="sourceLine" id="machine-render-31" data-line-number="31">            <span class="op">,</span> <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span> <span class="op">+</span> <span class="fu">pi</span><span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="machine-render-32" data-line-number="32">            <span class="op">,</span> <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span> <span class="op">+</span> <span class="fu">pi</span></a>
<a class="sourceLine" id="machine-render-33" data-line-number="33">            <span class="op">,</span> <span class="fu">art</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span><span class="fu">pi</span><span class="op">/</span><span class="dv">2</span> ]</a>
<a class="sourceLine" id="machine-render-34" data-line-number="34"></a>
<a class="sourceLine" id="machine-render-35" data-line-number="35"><span class="fu">crossHair</span> : <span class="dt">Position</span> <span class="op">-&gt;</span> <span class="dt">Svg</span> <span class="dt">Msg</span></a>
<a class="sourceLine" id="machine-render-36" data-line-number="36"><span class="fu">crossHair</span> { <span class="fu">x</span><span class="op">,</span> <span class="fu">y</span> } <span class="op">=</span></a>
<a class="sourceLine" id="machine-render-37" data-line-number="37">    <span class="fu">g</span> [] [ <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</a>
<a class="sourceLine" id="machine-render-38" data-line-number="38">                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</a>
<a class="sourceLine" id="machine-render-39" data-line-number="39">                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.04&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-40" data-line-number="40">         <span class="op">,</span> <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)</a>
<a class="sourceLine" id="machine-render-41" data-line-number="41">                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">15</span>)</a>
<a class="sourceLine" id="machine-render-42" data-line-number="42">                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.04&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-43" data-line-number="43">         <span class="op">,</span> <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</a>
<a class="sourceLine" id="machine-render-44" data-line-number="44">                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span>)</a>
<a class="sourceLine" id="machine-render-45" data-line-number="45">                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;white&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-46" data-line-number="46">         <span class="op">,</span> <span class="fu">line</span> [ <span class="fu">x1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y1</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">-</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)</a>
<a class="sourceLine" id="machine-render-47" data-line-number="47">                <span class="op">,</span> <span class="fu">x2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">x</span>)<span class="op">,</span> <span class="fu">y2</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">y</span> <span class="op">+</span> <span class="dv">0</span><span class="op">.</span><span class="dv">14</span>)</a>
<a class="sourceLine" id="machine-render-48" data-line-number="48">                <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;white&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-49" data-line-number="49">         ]</a>
<a class="sourceLine" id="machine-render-50" data-line-number="50"></a>
<a class="sourceLine" id="machine-render-51" data-line-number="51"><span class="fu">renderMachine</span> : <span class="dt">Machine</span> <span class="op">-&gt;</span> <span class="dt">Html</span> <span class="dt">Msg</span></a>
<a class="sourceLine" id="machine-render-52" data-line-number="52"><span class="fu">renderMachine</span> <span class="fu">m</span> <span class="op">=</span></a>
<a class="sourceLine" id="machine-render-53" data-line-number="53">    <span class="fu">svg</span> [ <span class="fu">width</span> <span class="st">&quot;100%&quot;</span></a>
<a class="sourceLine" id="machine-render-54" data-line-number="54">        <span class="op">,</span> <span class="fu">viewBox</span> <span class="st">&quot;-3500 -1500 8000 3000&quot;</span></a>
<a class="sourceLine" id="machine-render-55" data-line-number="55">        <span class="op">,</span> <span class="fu">onMouseMove</span> (\ <span class="fu">x</span> <span class="fu">y</span> <span class="op">-&gt;</span> <span class="dt">MouseMove</span> (<span class="dt">Position</span> <span class="fu">x</span> <span class="fu">y</span>))</a>
<a class="sourceLine" id="machine-render-56" data-line-number="56">        <span class="op">,</span> <span class="fu">onClick</span> <span class="dt">MouseClick</span> ]</a>
<a class="sourceLine" id="machine-render-57" data-line-number="57">        [ <span class="fu">g</span> [ <span class="fu">pointerEvents</span> <span class="st">&quot;bounding-box&quot;</span> ]</a>
<a class="sourceLine" id="machine-render-58" data-line-number="58">            [ <span class="fu">rect</span> [ <span class="fu">x</span> <span class="st">&quot;-3500&quot;</span><span class="op">,</span> <span class="fu">y</span> <span class="st">&quot;-1500&quot;</span><span class="op">,</span> <span class="fu">width</span> <span class="st">&quot;8000&quot;</span><span class="op">,</span> <span class="fu">height</span> <span class="st">&quot;3000&quot;</span></a>
<a class="sourceLine" id="machine-render-59" data-line-number="59">                   <span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;none&quot;</span> ] [] ]</a>
<a class="sourceLine" id="machine-render-60" data-line-number="60">        <span class="op">,</span> <span class="fu">g</span> [ <span class="fu">pointerEvents</span> <span class="st">&quot;none&quot;</span><span class="op">,</span> <span class="fu">transform</span> <span class="st">&quot;scale(1000)&quot;</span> ]</a>
<a class="sourceLine" id="machine-render-61" data-line-number="61">            [ <span class="fu">rect</span> [ <span class="fu">x</span> <span class="st">&quot;-3.5&quot;</span><span class="op">,</span> <span class="fu">y</span> <span class="st">&quot;-1.5&quot;</span><span class="op">,</span> <span class="fu">width</span> <span class="st">&quot;8&quot;</span><span class="op">,</span> <span class="fu">height</span> <span class="st">&quot;3&quot;</span></a>
<a class="sourceLine" id="machine-render-62" data-line-number="62">                   <span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;white&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-63" data-line-number="63">            <span class="op">,</span> <span class="fu">circle</span> [ <span class="fu">cx</span> <span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="fu">cy</span> <span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="fu">r</span> <span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;#ffcc88&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span></a>
<a class="sourceLine" id="machine-render-64" data-line-number="64">                     <span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-65" data-line-number="65">            <span class="op">,</span> <span class="fu">discDecoration</span> <span class="fu">m</span></a>
<a class="sourceLine" id="machine-render-66" data-line-number="66">            <span class="op">,</span> <span class="fu">polyline</span> [ <span class="fu">fill</span> <span class="st">&quot;none&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;white&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.08&quot;</span></a>
<a class="sourceLine" id="machine-render-67" data-line-number="67">                       <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">elasticPathString</span> <span class="fu">m</span> ] []</a>
<a class="sourceLine" id="machine-render-68" data-line-number="68">            <span class="op">,</span> <span class="fu">polyline</span> [ <span class="fu">fill</span> <span class="st">&quot;none&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.05&quot;</span></a>
<a class="sourceLine" id="machine-render-69" data-line-number="69">                       <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">elasticPathString</span> <span class="fu">m</span> ] []</a>
<a class="sourceLine" id="machine-render-70" data-line-number="70">            <span class="op">,</span> <span class="fu">polyline</span> [ <span class="fu">fill</span> <span class="st">&quot;#00000022&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span></a>
<a class="sourceLine" id="machine-render-71" data-line-number="71">                       <span class="op">,</span> <span class="fu">points</span> <span class="op">&lt;|</span> <span class="fu">potentialPathString</span> <span class="fu">m</span> ] []</a>
<a class="sourceLine" id="machine-render-72" data-line-number="72">            <span class="op">,</span> <span class="fu">crossHair</span> <span class="fu">m</span><span class="op">.</span><span class="fu">p</span></a>
<a class="sourceLine" id="machine-render-73" data-line-number="73">            <span class="op">,</span> <span class="fu">circle</span> [ <span class="fu">cx</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> (<span class="fu">wheelPosition</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span>)<span class="op">.</span><span class="fu">x</span>)</a>
<a class="sourceLine" id="machine-render-74" data-line-number="74">                     <span class="op">,</span> <span class="fu">cy</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> (<span class="fu">wheelPosition</span> <span class="fu">m</span><span class="op">.</span><span class="fu">theta</span>)<span class="op">.</span><span class="fu">y</span>)</a>
<a class="sourceLine" id="machine-render-75" data-line-number="75">                     <span class="op">,</span> <span class="fu">r</span> <span class="st">&quot;0.07&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;#ffaa88&quot;</span><span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-76" data-line-number="76">            <span class="op">,</span> <span class="fu">circle</span> [ <span class="fu">cx</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">f</span><span class="op">.</span><span class="fu">x</span>)<span class="op">,</span> <span class="fu">strokeWidth</span> <span class="st">&quot;0.01&quot;</span><span class="op">,</span> <span class="fu">stroke</span> <span class="st">&quot;black&quot;</span></a>
<a class="sourceLine" id="machine-render-77" data-line-number="77">                     <span class="op">,</span> <span class="fu">cy</span> (<span class="fu">fromFloat</span> <span class="op">&lt;|</span> <span class="fu">m</span><span class="op">.</span><span class="fu">f</span><span class="op">.</span><span class="fu">y</span>)<span class="op">,</span> <span class="fu">r</span> <span class="st">&quot;0.07&quot;</span><span class="op">,</span> <span class="fu">fill</span> <span class="st">&quot;#ffaa88&quot;</span> ] []</a>
<a class="sourceLine" id="machine-render-78" data-line-number="78">            ]</a>
<a class="sourceLine" id="machine-render-79" data-line-number="79">        ]</a></code></pre></div>
<h3 id="scaffold">Scaffold</h3>
<p><em>file: «src/Machine.elm»=</em></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode elm"><code class="sourceCode elm"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">module</span> <span class="dt">Machine</span> <span class="kw">exposing</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    ( <span class="dt">Machine</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="op">,</span> <span class="fu">renderMachine</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    <span class="op">,</span> <span class="fu">fromPosition</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="op">,</span> <span class="fu">minimizeMachine</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="op">,</span> <span class="fu">dPotential</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    <span class="op">,</span> <span class="fu">d2Potential</span> )</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="op">&lt;&lt;</span><span class="kw">import</span><span class="op">-</span><span class="fu">svg</span><span class="op">&gt;&gt;</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">import</span> <span class="dt">String</span> <span class="kw">exposing</span> (<span class="fu">fromFloat</span><span class="op">,</span> <span class="fu">fromInt</span>)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">import</span> <span class="dt">Msg</span> <span class="kw">exposing</span> (<span class="dt">Msg</span>(<span class="op">..</span>)<span class="op">,</span> <span class="dt">Position</span>)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="op">&lt;&lt;</span><span class="fu">machine</span><span class="op">-</span><span class="fu">datatype</span><span class="op">&gt;&gt;</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="op">&lt;&lt;</span><span class="fu">brentish</span><span class="op">&gt;&gt;</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="op">&lt;&lt;</span><span class="fu">machine</span><span class="op">-</span><span class="fu">render</span><span class="op">&gt;&gt;</span></a></code></pre></div>
</body>
</html>
