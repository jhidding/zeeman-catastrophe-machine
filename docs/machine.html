<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>The catastrophe machine</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">The catastrophe machine</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#the-math">The math</a><ul>
<li><a href="#problem">Problem</a></li>
<li><a href="#numerical-methods">Numerical methods</a></li>
</ul></li>
<li><a href="#appendix">Appendix</a><ul>
<li><a href="#rendering">Rendering</a></li>
</ul></li>
</ul>
</nav>
<p><em>file: «src/Machine.elm»=</em></p>
<pre class="elm"><code>module Machine exposing (Machine, renderMachine)

&lt;&lt;import-svg&gt;&gt;
import String exposing (fromFloat, fromInt)

import Msg exposing (Msg(..), Position)

&lt;&lt;machine-datatype&gt;&gt;

&lt;&lt;machine-render&gt;&gt;</code></pre>
<h2 id="the-math">The math</h2>
<h3 id="problem">Problem</h3>
<p>We have disk of radius <span class="math inline">\(R\)</span> at the origin, a pin on the edge of this disk at angle <span class="math inline">\(\theta\)</span>, an elastic from the pin to a point on the <span class="math inline">\(x\)</span>-axis, and another elastic from the pin to a free moving pointer, see fig. <a href="#fig:system">1</a>.</p>
<div id="fig:system" class="fignos">
<figure>
<img src="system.svg" alt="Figure 1: Zeeman’s catastrophe machine" /><figcaption><span>Figure 1:</span> Zeeman’s catastrophe machine</figcaption>
</figure>
</div>
<p>We define the machine model by the position of the pointer and the angle of the disc.</p>
<p><em>«machine-datatype»=</em></p>
<pre id="machine-datatype" class="elm"><code>type alias Machine =
    { pointer : Position
    , angle   : Float
    }</code></pre>
<p>At each time we need to minimize the potential given the pointer position, taking the current angle as the initial guess. To compute the potential, we model the elastics as linear springs, with a relaxed length of 1.</p>
<p><span class="math display">\[l_a^2 = \sin^2 \theta + (\cos \theta - 2.0)^2\]</span> <span class="math display">\[l_b^2 = (\cos \theta - x)^2 + (\sin \theta - y)^2\]</span> <span class="math display">\[V \sim \left[ (l_a - 1)^2 + (l_b - 1)^2 \right]\]</span></p>
<p>To compute the minimum it is convenient to have the derivative of the potential.</p>
<p><span class="math display">\[\frac{\partial l_a}{\partial \theta} = \frac{2.0 \sin\theta}{l_a},\]</span> <span class="math display">\[\frac{\partial l_b}{\partial \theta} = \frac{x\sin\theta - y\cos\theta}{l_b},\]</span> <span class="math display">\[\frac{\partial V}{\partial l_a} \sim 2 (l_a - 1),\]</span></p>
<p>and similar for <span class="math inline">\(\partial V / \partial l_b\)</span>, which is then enough to construct a function computing <span class="math inline">\(\partial V / \partial \theta\)</span>.</p>
<h3 id="numerical-methods">Numerical methods</h3>
<p><em>«newton-raphson»=</em></p>
<pre id="newton-raphson" class="elm"><code></code></pre>
<h2 id="appendix">Appendix</h2>
<p><em>«plot-system»=</em></p>
<div class="sourceCode" id="plot-system"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="plot-system-1" data-line-number="1">using Gadfly</a>
<a class="sourceLine" id="plot-system-2" data-line-number="2"></a>
<a class="sourceLine" id="plot-system-3" data-line-number="3">t = collect(<span class="fl">0</span>.:<span class="fl">0.05</span>:<span class="fl">2</span>pi)</a>
<a class="sourceLine" id="plot-system-4" data-line-number="4">push!(t, t[<span class="fl">1</span>])</a>
<a class="sourceLine" id="plot-system-5" data-line-number="5"></a>
<a class="sourceLine" id="plot-system-6" data-line-number="6">phi = <span class="fl">3</span>*pi/<span class="fl">5</span></a>
<a class="sourceLine" id="plot-system-7" data-line-number="7">u, v = cos(phi), sin(phi)</a>
<a class="sourceLine" id="plot-system-8" data-line-number="8">p, q = <span class="fl">2.0</span>, <span class="fl">0.5</span></a>
<a class="sourceLine" id="plot-system-9" data-line-number="9"></a>
<a class="sourceLine" id="plot-system-10" data-line-number="10">disc = layer(</a>
<a class="sourceLine" id="plot-system-11" data-line-number="11">    x=cos.(t), y = sin.(t), Geom.polygon(fill=true), Geom.path,</a>
<a class="sourceLine" id="plot-system-12" data-line-number="12">    order=-<span class="fl">1</span>, Theme(alphas=[<span class="fl">0.4</span>]))</a>
<a class="sourceLine" id="plot-system-13" data-line-number="13">angle = layer(</a>
<a class="sourceLine" id="plot-system-14" data-line-number="14">    x=[<span class="fl">1</span>, <span class="fl">0</span>, u], y=[<span class="fl">0</span>, <span class="fl">0</span>, v], Geom.path,</a>
<a class="sourceLine" id="plot-system-15" data-line-number="15">    Theme(default_color=colorant<span class="st">&quot;black&quot;</span>))</a>
<a class="sourceLine" id="plot-system-16" data-line-number="16">labels = layer(</a>
<a class="sourceLine" id="plot-system-17" data-line-number="17">    x=[<span class="fl">0.1</span>, p + <span class="fl">0.1</span>], y=[<span class="fl">0.4</span>, q], label=[<span class="st">&quot;θ&quot;</span>, <span class="st">&quot;q&quot;</span>], Geom.label,</a>
<a class="sourceLine" id="plot-system-18" data-line-number="18">    Theme(point_label_font_size=<span class="fl">10</span>pt))</a>
<a class="sourceLine" id="plot-system-19" data-line-number="19">elastic = layer(</a>
<a class="sourceLine" id="plot-system-20" data-line-number="20">    x=[-<span class="fl">2</span>, u, p], y=[<span class="fl">0.0</span>, v, q], Geom.path, Geom.point,</a>
<a class="sourceLine" id="plot-system-21" data-line-number="21">    Theme(default_color=colorant<span class="st">&quot;teal&quot;</span>, line_width=<span class="fl">2</span>pt, point_size=<span class="fl">3</span>pt),</a>
<a class="sourceLine" id="plot-system-22" data-line-number="22">    order=<span class="fl">2</span>)</a>
<a class="sourceLine" id="plot-system-23" data-line-number="23"></a>
<a class="sourceLine" id="plot-system-24" data-line-number="24">plt = plot(disc, angle, elastic, labels,</a>
<a class="sourceLine" id="plot-system-25" data-line-number="25">     Coord.cartesian(xmin=-<span class="fl">2.5</span>, xmax=<span class="fl">2.5</span>, ymin=-<span class="fl">1.2</span>, ymax=<span class="fl">1.2</span>, fixed=true),</a>
<a class="sourceLine" id="plot-system-26" data-line-number="26">     Theme(</a>
<a class="sourceLine" id="plot-system-27" data-line-number="27">        panel_fill=colorant<span class="st">&quot;gray90&quot;</span>, key_position=:none,</a>
<a class="sourceLine" id="plot-system-28" data-line-number="28">        grid_color=colorant<span class="st">&quot;gray30&quot;</span>),</a>
<a class="sourceLine" id="plot-system-29" data-line-number="29">     Guide.xticks(ticks=[-<span class="fl">2</span>, -<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>]))</a>
<a class="sourceLine" id="plot-system-30" data-line-number="30"></a>
<a class="sourceLine" id="plot-system-31" data-line-number="31">img = SVG(<span class="st">&quot;system.svg&quot;</span>, <span class="fl">14</span>cm, <span class="fl">7</span>cm)</a>
<a class="sourceLine" id="plot-system-32" data-line-number="32">draw(img, plt)</a></code></pre></div>
<h3 id="rendering">Rendering</h3>
<p><em>«import-svg»=</em></p>
<pre id="import-svg" class="elm"><code>import Svg exposing (..)
import Svg.Attributes exposing (..)

import Html exposing (Html)
import MouseMove exposing (onMouseMove)</code></pre>
<p><em>«machine-render»=</em></p>
<pre id="machine-render" class="elm"><code>renderMachine : Machine -&gt; Html Msg
renderMachine m =
    svg [ width &quot;100%&quot;
        , viewBox &quot;-4000 -1200 8000 2400&quot;
        , onMouseMove (\ x y -&gt; MouseMove (Position x y)) ]
        [ g [ pointerEvents &quot;all&quot; ]
            [ rect [ x &quot;-4000&quot;, y &quot;-1200&quot;, width &quot;8000&quot;, height &quot;2400&quot;
                   , fill &quot;none&quot; ] [] ]
        , g [ pointerEvents &quot;none&quot;, transform &quot;scale(1000)&quot; ]
            [ rect [ x &quot;-3&quot;, y &quot;-1&quot;, width &quot;6&quot;, height &quot;2&quot;
                   , stroke &quot;black&quot;, strokeWidth &quot;0.01&quot;, fill &quot;white&quot; ] []
            , circle [ cx (fromFloat &lt;| m.pointer.x - 4.0)
                     , cy (fromFloat &lt;| m.pointer.y - 1.2), r &quot;0.1&quot;, fill &quot;red&quot; ] [] ] ]</code></pre>
</body>
</html>
